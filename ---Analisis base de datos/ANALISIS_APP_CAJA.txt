â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ANÃLISIS DIAGNÃ“STICO: APP CAJA
  Sistema de FacturaciÃ³n y Cobros - Veterinaria Santa SofÃ­a
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Fecha de anÃ¡lisis: [AnÃ¡lisis actual]
ğŸ¯ PropÃ³sito: DiagnÃ³stico de modelos, uso real y dependencias
âš ï¸  Modalidad: SOLO LECTURA - Sin modificaciones de cÃ³digo

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1. MODELOS IDENTIFICADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SISTEMA LEGACY (OBSOLETO - EN DESUSO)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“¦ Modelo: Caja
   â””â”€ UbicaciÃ³n: caja/models.py (lÃ­neas 8-25)
   â””â”€ PropÃ³sito original: Representar sesiones de caja (apertura/cierre)
   â””â”€ Campos principales:
      â€¢ usuario (FK a User)
      â€¢ fecha_apertura (DateTimeField)
      â€¢ fecha_cierre (DateTimeField, nullable)
      â€¢ monto_inicial (DecimalField)
      â€¢ monto_final (DecimalField, nullable)
      â€¢ observaciones (TextField)

ğŸ“¦ Modelo: MovimientoCaja
   â””â”€ UbicaciÃ³n: caja/models.py (lÃ­neas 28-61)
   â””â”€ PropÃ³sito original: Registrar ingresos/egresos en sesiones de caja
   â””â”€ Campos principales:
      â€¢ caja (FK a Caja)
      â€¢ tipo (CharField: 'ingreso' / 'egreso')
      â€¢ monto (DecimalField)
      â€¢ concepto (CharField)
      â€¢ metodo_pago (CharField)
      â€¢ descripcion (TextField)
      â€¢ fecha (DateTimeField, auto_now_add)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SISTEMA MODERNO (EN USO ACTIVO)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“¦ Modelo: SesionCaja
   â””â”€ UbicaciÃ³n: caja/models.py (lÃ­neas 67-113)
   â””â”€ PropÃ³sito: Control diario de caja con apertura/cierre
   â””â”€ Campos principales:
      â€¢ fecha_apertura (DateTimeField, auto_now_add)
      â€¢ fecha_cierre (DateTimeField, nullable)
      â€¢ usuario_apertura (FK a User)
      â€¢ usuario_cierre (FK a User, nullable)
      â€¢ monto_inicial (DecimalField)
      â€¢ monto_final (DecimalField, nullable)
      â€¢ monto_contado (DecimalField, nullable) - Arqueo fÃ­sico
      â€¢ diferencia (DecimalField, nullable) - Descuadre detectado
      â€¢ esta_cerrada (BooleanField, default=False)
      â€¢ observaciones_apertura (TextField)
      â€¢ observaciones_cierre (TextField)
   â””â”€ Relaciones:
      â€¢ ventas: Venta.sesion (reverse OneToMany)
   â””â”€ MÃ©todos:
      â€¢ calcular_monto_final(): Suma ventas pagadas de la sesiÃ³n

ğŸ“¦ Modelo: Venta
   â””â”€ UbicaciÃ³n: caja/models.py (lÃ­neas 116-241)
   â””â”€ PropÃ³sito: Representar facturas/cobros (pendientes o pagados)
   â””â”€ Campos principales:
      â€¢ numero (CharField, auto-generado: "V{YYYYMMDD}-{contador}")
      â€¢ tipo_origen (CharField: 'consulta', 'hospitalizacion', 'venta_libre')
      â€¢ estado (CharField: 'pendiente', 'pagado', 'cancelado')
      â€¢ paciente (FK a Paciente, nullable)
      â€¢ consulta (OneToOneField a Consulta, nullable)
      â€¢ hospitalizacion (OneToOneField a Hospitalizacion, nullable)
      â€¢ fecha_creacion (DateTimeField, auto_now_add)
      â€¢ fecha_pago (DateTimeField, nullable)
      â€¢ metodo_pago (CharField: 'efectivo', 'tarjeta', 'transferencia')
      â€¢ sesion (FK a SesionCaja, nullable)
      â€¢ usuario_creacion (FK a User)
      â€¢ usuario_cobro (FK a User, nullable)
      â€¢ subtotal (DecimalField)
      â€¢ descuento (DecimalField, default=0)
      â€¢ total (DecimalField)
      â€¢ observaciones (TextField)
   â””â”€ Relaciones:
      â€¢ detalles: DetalleVenta.venta (reverse OneToMany)
      â€¢ auditoria: AuditoriaCaja.venta (reverse OneToMany)
   â””â”€ MÃ©todos clave:
      â€¢ save(): Genera nÃºmero de venta automÃ¡tico en formato V{YYYYMMDD}-{contador}
      â€¢ calcular_totales(): Recalcula subtotal y total desde DetalleVenta
   â””â”€ IntegraciÃ³n:
      â€¢ Se crea automÃ¡ticamente desde clinica.Consulta (signal)
      â€¢ Se crea automÃ¡ticamente desde clinica.Hospitalizacion (signal)

ğŸ“¦ Modelo: DetalleVenta
   â””â”€ UbicaciÃ³n: caja/models.py (lÃ­neas 244-297)
   â””â”€ PropÃ³sito: LÃ­neas de factura (servicios e insumos)
   â””â”€ Campos principales:
      â€¢ venta (FK a Venta)
      â€¢ tipo (CharField: 'servicio' / 'insumo')
      â€¢ servicio (FK a Servicio, nullable)
      â€¢ insumo (FK a Insumo, nullable)
      â€¢ descripcion (CharField) - Texto del Ã­tem
      â€¢ cantidad (DecimalField)
      â€¢ precio_unitario (DecimalField)
      â€¢ subtotal (DecimalField, auto-calculado)
      â€¢ stock_descontado (BooleanField, default=False)
      â€¢ fecha_descuento_stock (DateTimeField, nullable)
      â€¢ peso_paciente (DecimalField, nullable) - Para cÃ¡lculo de dosis
      â€¢ dosis_calculada_ml (DecimalField, nullable)
      â€¢ ml_contenedor (DecimalField, nullable)
      â€¢ calculo_automatico (BooleanField, default=False)
   â””â”€ MÃ©todos:
      â€¢ save(): Calcula subtotal automÃ¡ticamente (cantidad Ã— precio_unitario)
   â””â”€ Regla crÃ­tica:
      â€¢ stock_descontado marca si ya se descontÃ³ inventario (solo en pago)

ğŸ“¦ Modelo: AuditoriaCaja
   â””â”€ UbicaciÃ³n: caja/models.py (lÃ­neas 300-340)
   â””â”€ PropÃ³sito: Registro de auditorÃ­a completo de todas las operaciones
   â””â”€ Campos principales:
      â€¢ venta (FK a Venta, nullable)
      â€¢ sesion (FK a SesionCaja, nullable)
      â€¢ fecha (DateTimeField, auto_now_add)
      â€¢ usuario (FK a User)
      â€¢ accion (CharField: 'crear_venta', 'agregar_detalle', 'eliminar_detalle',
                         'modificar_detalle', 'aplicar_descuento', 'confirmar_pago',
                         'cancelar_venta', 'abrir_sesion', 'cerrar_sesion')
      â€¢ descripcion (TextField) - DescripciÃ³n legible
      â€¢ datos_anteriores (JSONField, nullable) - Snapshot "antes"
      â€¢ datos_nuevos (JSONField, nullable) - Snapshot "despuÃ©s"
   â””â”€ Uso: Trazabilidad completa de cambios financieros

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2. USO REAL DEL SISTEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO PRINCIPAL: COBRO DESDE CONSULTA                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: caja/services.py (crear_cobro_pendiente_desde_consulta)
Disparador: Signal post_save en clinica.Consulta (clinica/signals.py)

Pasos automÃ¡ticos:
1. Se guarda una Consulta con servicios/insumos
2. Signal detecta que no tiene Venta asociada
3. Llama a crear_cobro_pendiente_desde_consulta()
4. Crea Venta en estado 'pendiente' con OneToOne a Consulta
5. Agrega DetalleVenta por cada servicio de la consulta
6. Agrega DetalleVenta por cada insumo de ConsultaInsumo (con cÃ¡lculo de dosis)
7. Llama a venta.calcular_totales()
8. Registra auditorÃ­a en AuditoriaCaja

Resultado: La consulta queda con una factura pendiente de pago automÃ¡ticamente

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO PRINCIPAL: COBRO DESDE HOSPITALIZACIÃ“N                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: caja/services.py (crear_cobro_pendiente_desde_hospitalizacion)
Disparador: Signal post_save cuando Hospitalizacion.estado == 'alta'

Pasos automÃ¡ticos:
1. Se da de alta una HospitalizaciÃ³n (estado='alta')
2. Signal detecta que no tiene Venta asociada
3. Llama a crear_cobro_pendiente_desde_hospitalizacion()
4. Crea Venta en estado 'pendiente' con OneToOne a Hospitalizacion
5. Agrega DetalleVenta por cada HospitalizacionInsumo
6. Por cada Cirugia de la hospitalizaciÃ³n:
   â€¢ Agrega servicio de cirugÃ­a (si tiene)
   â€¢ Agrega cada CirugiaInsumo como DetalleVenta
7. Llama a venta.calcular_totales()
8. Registra auditorÃ­a

Resultado: Al dar de alta, se genera factura con TODOS los gastos del internamiento

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO: PROCESAMIENTO DE PAGO                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: caja/services.py (procesar_pago)

Pasos crÃ­ticos:
1. Verifica que Venta.estado == 'pendiente'
2. Verifica que SesionCaja estÃ© abierta
3. Cambia estado de Venta a 'pagado'
4. Asigna metodo_pago, fecha_pago, usuario_cobro, sesion
5. **DESCUENTA STOCK DE INVENTARIO** (descontar_stock_insumo)
   â””â”€ Por cada DetalleVenta tipo='insumo':
      â€¢ Verifica stock disponible
      â€¢ Descuenta Insumo.stock_actual
      â€¢ Marca DetalleVenta.stock_descontado = True
      â€¢ Marca fecha_descuento_stock
6. Registra auditorÃ­a

âš ï¸ REGLA CRÃTICA: El stock SOLO se descuenta aquÃ­, NUNCA antes
   â””â”€ Esto permite editar ventas pendientes sin afectar inventario

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO: SESIONES DE CAJA                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: caja/services.py (abrir_sesion_caja, cerrar_sesion_caja)

Apertura:
1. Verifica que no haya otra sesiÃ³n abierta
2. Crea SesionCaja con monto_inicial
3. Registra auditorÃ­a

Cierre:
1. Verifica que no haya ventas pendientes en la sesiÃ³n
2. Usuario ingresa monto_contado (arqueo fÃ­sico)
3. Calcula monto_final desde ventas pagadas
4. Calcula diferencia = monto_contado - monto_final
5. Marca sesion.esta_cerrada = True
6. Registra auditorÃ­a

Uso: Control diario de efectivo, detecciÃ³n de descuadres

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FLUJO: VENTA LIBRE                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: caja/services.py (crear_venta_libre)

PropÃ³sito: Venta directa sin consulta ni hospitalizaciÃ³n
Pasos:
1. Crea Venta con tipo_origen='venta_libre'
2. Agrega servicios e insumos manualmente
3. Calcula totales
4. Registra auditorÃ­a

Uso: Venta de productos sin atenciÃ³n mÃ©dica

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SISTEMA LEGACY: Caja / MovimientoCaja                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: caja/views.py (cashregister, apertura_cierre, etc.)

Estado: OBSOLETO - AÃºn tiene vistas funcionales pero no integrado con sistema moderno
Funciones:
- cashregister(): Vista de caja registradora legacy
- apertura_cierre(): Apertura/cierre de Caja (modelo legacy)
- procesar_venta(): Descuenta stock directamente (sin Venta intermedia)
- registrar_movimiento(): Crea MovimientoCaja

Problema: No estÃ¡ integrado con SesionCaja/Venta moderno

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3. DEPENDENCIAS CON OTRAS APPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEPENDENCIAS DIRECTAS (FK / OneToOne)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

caja â†’ clinica (CRÃTICA):
   â€¢ Venta.consulta (OneToOneField a Consulta)
   â€¢ Venta.hospitalizacion (OneToOneField a Hospitalizacion)
   â””â”€ Uso: VinculaciÃ³n automÃ¡tica de cobros con atenciÃ³n mÃ©dica

caja â†’ pacientes (CRÃTICA):
   â€¢ Venta.paciente (FK a Paciente)
   â””â”€ Uso: Asignar factura a dueÃ±o del paciente

caja â†’ servicios (CRÃTICA):
   â€¢ DetalleVenta.servicio (FK a Servicio)
   â””â”€ Uso: Facturar servicios veterinarios (consultas, cirugÃ­as, etc.)

caja â†’ inventario (CRÃTICA):
   â€¢ DetalleVenta.insumo (FK a Insumo)
   â””â”€ Uso: Facturar medicamentos/insumos y descontar stock

caja â†’ cuentas (CRÃTICA):
   â€¢ SesionCaja.usuario_apertura / usuario_cierre (FK a User)
   â€¢ Venta.usuario_creacion / usuario_cobro (FK a User)
   â€¢ AuditoriaCaja.usuario (FK a User)
   â””â”€ Uso: Trazabilidad de quiÃ©n opera la caja

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEPENDENCIAS INVERSAS (Otras apps usan caja)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

clinica â†’ caja (Signal crÃ­tico):
   â€¢ clinica/signals.py: Importa crear_cobro_pendiente_desde_consulta
   â€¢ Signal post_save en Consulta llama a crear_cobro_pendiente_desde_consulta
   â€¢ Signal post_save en Hospitalizacion llama a crear_cobro_pendiente_desde_hospitalizacion
   â””â”€ Uso: CreaciÃ³n automÃ¡tica de cobros pendientes

dashboard â†’ caja (Reportes):
   â€¢ dashboard/views.py: Importa SesionCaja, Venta, DetalleVenta
   â””â”€ Uso: EstadÃ­sticas de ventas, ingresos diarios, top servicios

pacientes â†’ caja (Historial):
   â€¢ Paciente tiene reverse FK 'ventas'
   â””â”€ Uso: Historial de facturas del paciente

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INTEGRACIÃ“N CON INVENTARIO                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Flujo: caja/services.py â†’ descontar_stock_insumo()

Regla crÃ­tica: El stock SOLO se descuenta cuando se PAGA la venta
1. Venta se crea en estado 'pendiente' â†’ stock NO se toca
2. Usuario confirma pago â†’ llama a procesar_pago()
3. procesar_pago() descuenta stock de cada DetalleVenta tipo='insumo'
4. Actualiza Insumo.stock_actual, tipo_ultimo_movimiento='salida'
5. Marca DetalleVenta.stock_descontado = True

Beneficio: Permite editar ventas pendientes sin afectar inventario

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4. SOLAPAMIENTOS Y MODELOS DUPLICADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SISTEMA DUAL: LEGACY vs MODERNO                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”´ DUPLICACIÃ“N DETECTADA:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONCEPTO            â”‚ MODELO LEGACY        â”‚ MODELO MODERNO              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SesiÃ³n de caja      â”‚ Caja                 â”‚ SesionCaja                  â”‚
â”‚ Movimientos         â”‚ MovimientoCaja       â”‚ Venta + DetalleVenta        â”‚
â”‚ Control de stock    â”‚ Descuento directo    â”‚ Descuento en pago           â”‚
â”‚ AuditorÃ­a           â”‚ No tiene             â”‚ AuditoriaCaja (completo)    â”‚
â”‚ IntegraciÃ³n clÃ­nica â”‚ No tiene             â”‚ Signal automÃ¡tico           â”‚
â”‚ NÃºmero de venta     â”‚ No tiene             â”‚ Auto-generado V{fecha}-{n}  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Estado actual:
â€¢ Sistema LEGACY (Caja/MovimientoCaja): Tiene vistas funcionales en views.py
â€¢ Sistema MODERNO (SesionCaja/Venta): Tiene vistas en views_cobros.py
â€¢ Ambos sistemas coexisten pero NO estÃ¡n integrados

Problema:
- Si se usa views.py (legacy), no se crean registros en Venta/SesionCaja
- Si se usa views_cobros.py (moderno), no se crean registros en Caja/MovimientoCaja
- No hay migraciÃ³n de datos entre sistemas

Rutas:
â€¢ caja/urls.py: Rutas del sistema legacy (cashregister, apertura_cierre, etc.)
â€¢ caja/urls_cobros.py: Rutas del sistema moderno (dashboard_caja, lista_cobros_pendientes, etc.)

Templates:
â€¢ Legacy: cash_register.html, apertura_cierre.html, reporte.html
â€¢ Moderno: dashboard_caja.html (en caja/templates/caja/)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONCLUSIÃ“N: DOS SISTEMAS PARALELOS                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

El sistema moderno (SesionCaja/Venta) es:
âœ… MÃ¡s completo (auditorÃ­a, nÃºmeros de venta, descuentos)
âœ… Integrado con clinica (creaciÃ³n automÃ¡tica de cobros)
âœ… Control de stock mÃ¡s robusto (solo descuenta en pago)
âœ… Mejor trazabilidad (AuditoriaCaja)

El sistema legacy (Caja/MovimientoCaja):
âŒ Sin integraciÃ³n con clinica
âŒ Sin auditorÃ­a
âŒ Descuento de stock inmediato (riesgoso)
âŒ Sin nÃºmeros de venta
âŒ No permite editar ventas

Pero ambos estÃ¡n activos en el cÃ³digo.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5. CLASIFICACIÃ“N DE RIESGO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ MODELOS CRÃTICOS - NO ELIMINAR                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SesionCaja - ğŸ”´ CRÃTICA
   Motivo: Control diario de caja, requerido por auditorÃ­a
   Uso activo: Integrado con dashboard, usado en views_cobros.py
   Dependencias: Venta.sesion (todas las ventas pagadas se asocian a sesiÃ³n)
   Riesgo de eliminaciÃ³n: ALTO - PÃ©rdida de control de efectivo

Venta - ğŸ”´ CRÃTICA
   Motivo: Centro del sistema de facturaciÃ³n
   Uso activo: CreaciÃ³n automÃ¡tica desde clinica (signals)
   Dependencias: 
      â€¢ clinica.Consulta.venta (OneToOne reverse)
      â€¢ clinica.Hospitalizacion.venta (OneToOne reverse)
      â€¢ DetalleVenta.venta (todos los detalles)
      â€¢ AuditoriaCaja.venta (toda la auditorÃ­a)
      â€¢ dashboard importa para reportes
   Riesgo de eliminaciÃ³n: MUY ALTO - Colapso del sistema de cobros

DetalleVenta - ğŸ”´ CRÃTICA
   Motivo: LÃ­neas de factura, control de quÃ© se cobrÃ³
   Uso activo: Usado en crear_cobro_pendiente_*, procesar_pago
   Dependencias: Venta.detalles (todas las ventas tienen detalles)
   Riesgo de eliminaciÃ³n: MUY ALTO - PÃ©rdida de detalle de cobros

AuditoriaCaja - ğŸ”´ CRÃTICA
   Motivo: Trazabilidad legal de operaciones financieras
   Uso activo: Registrada en todas las operaciones de services.py
   Dependencias: Usado en reportes y auditorÃ­a interna
   Riesgo de eliminaciÃ³n: ALTO - PÃ©rdida de auditorÃ­a legal

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¢ MODELOS CANDIDATOS A ELIMINAR                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Caja - ğŸŸ¢ CANDIDATO A ELIMINAR
   Motivo: Reemplazado completamente por SesionCaja
   Uso actual: Solo usado en views.py (legacy)
   Alternativa moderna: SesionCaja tiene los mismos campos + mejoras
   Riesgo de eliminaciÃ³n: BAJO - Si se migran datos a SesionCaja

MovimientoCaja - ğŸŸ¢ CANDIDATO A ELIMINAR
   Motivo: Reemplazado por Venta + DetalleVenta
   Uso actual: Solo usado en views.py (legacy)
   Alternativa moderna: DetalleVenta con mÃ¡s detalles
   Riesgo de eliminaciÃ³n: BAJO - Si se migran datos a Venta/DetalleVenta

Condiciones para eliminar legacy:
1. Migrar datos de Caja â†’ SesionCaja
2. Migrar datos de MovimientoCaja â†’ Venta/DetalleVenta
3. Eliminar rutas de urls.py (sistema legacy)
4. Eliminar views.py (vistas legacy)
5. Eliminar templates legacy (cash_register.html, apertura_cierre.html)
6. Actualizar forms.py (eliminar AperturaCajaForm, CierreCajaForm)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6. CONCLUSIÃ“N FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESTADO ACTUAL:
--------------
La app 'caja' es el CENTRO FINANCIERO del sistema VetSantaSofia. Maneja toda
la facturaciÃ³n, cobros, control de caja y descuento de inventario.

ARQUITECTURA:
------------
Sistema DUAL con dos arquitecturas paralelas:

1. SISTEMA MODERNO (SesionCaja/Venta/DetalleVenta/AuditoriaCaja):
   â€¢ UbicaciÃ³n: models.py (lÃ­neas 67-340), services.py, views_cobros.py
   â€¢ Estado: EN USO ACTIVO
   â€¢ IntegraciÃ³n: AutomÃ¡tica con clinica via signals
   â€¢ CaracterÃ­sticas:
     âœ… CreaciÃ³n automÃ¡tica de cobros desde consultas/hospitalizaciones
     âœ… NÃºmeros de venta auto-generados (V{YYYYMMDD}-{contador})
     âœ… EdiciÃ³n de ventas pendientes
     âœ… Descuento de stock SOLO en pago (no antes)
     âœ… AuditorÃ­a completa (AuditoriaCaja con JSONField)
     âœ… Control de sesiones de caja con arqueo
     âœ… DetecciÃ³n de descuadres (diferencia)
     âœ… Manejo de descuentos
     âœ… MÃºltiples mÃ©todos de pago

2. SISTEMA LEGACY (Caja/MovimientoCaja):
   â€¢ UbicaciÃ³n: models.py (lÃ­neas 8-61), views.py
   â€¢ Estado: OBSOLETO - Funcional pero no integrado
   â€¢ CaracterÃ­sticas:
     âŒ Sin integraciÃ³n con clinica
     âŒ Sin auditorÃ­a
     âŒ Descuento de stock inmediato (riesgoso)
     âŒ Sin nÃºmeros de venta
     âŒ No permite editar ventas

FLUJO OPERATIVO REAL:
----------------------
1. Veterinario crea Consulta con servicios/insumos
2. Signal en clinica detecta guardado
3. Llama a caja.services.crear_cobro_pendiente_desde_consulta()
4. Se crea Venta automÃ¡ticamente en estado 'pendiente'
5. Se agregan DetalleVenta por cada servicio/insumo
6. RecepciÃ³n procesa pago llamando a caja.services.procesar_pago()
7. Se descuenta stock de inventario
8. Se registra pago en SesionCaja activa
9. Se genera auditorÃ­a completa

Mismo flujo para Hospitalizacion al dar de alta.

DEPENDENCIAS CRÃTICAS:
---------------------
â€¢ clinica: Consulta/Hospitalizacion crean Venta automÃ¡ticamente
â€¢ inventario: Descuento de stock en pago
â€¢ servicios: Precios de servicios veterinarios
â€¢ pacientes: AsignaciÃ³n de facturas
â€¢ dashboard: Reportes de ventas
â€¢ cuentas: Usuarios que operan caja

CLASIFICACIÃ“N DE RIESGO:
-----------------------
ğŸ”´ CRÃTICOS (NO ELIMINAR):
   â€¢ SesionCaja: Control diario de caja
   â€¢ Venta: Centro del sistema de facturaciÃ³n
   â€¢ DetalleVenta: Detalle de quÃ© se cobrÃ³
   â€¢ AuditoriaCaja: Trazabilidad legal

ğŸŸ¢ CANDIDATOS A ELIMINAR (Requieren migraciÃ³n de datos):
   â€¢ Caja: Reemplazado por SesionCaja
   â€¢ MovimientoCaja: Reemplazado por Venta/DetalleVenta

RECOMENDACIÃ“N OPERATIVA:
-----------------------
El sistema de caja moderno estÃ¡ bien diseÃ±ado y funcionando. Los modelos legacy
(Caja/MovimientoCaja) pueden eliminarse SI se migran los datos histÃ³ricos primero.

Prioridad: ğŸ”´ MÃXIMA
La app 'caja' es absolutamente crÃ­tica para la operaciÃ³n diaria. Cualquier
problema en esta app detiene la facturaciÃ³n y cobros de toda la veterinaria.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FIN DEL ANÃLISIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
