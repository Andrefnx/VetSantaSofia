================================================================================
                    ANÃLISIS DE LA APP "PACIENTES"
================================================================================
Fecha: 15 de Diciembre de 2025
Sistema: VetSantaSofia - Sistema de GestiÃ³n Veterinaria
================================================================================

================================================================================
1. MODELOS DE LA APP
================================================================================

La app "pacientes" define 2 modelos principales que son el NÃšCLEO MAESTRO
del sistema veterinario:

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MODELO 1: Propietario
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Archivo: pacientes/models.py (lÃ­neas 9-27)

ROL FUNCIONAL REAL:
Representa a los dueÃ±os de las mascotas. Es el modelo maestro de clientes
de la clÃ­nica veterinaria.

CAMPOS:
- nombre (CharField, max_length=100)
- apellido (CharField, max_length=100)
- telefono (CharField, max_length=20, opcional)
- email (EmailField, opcional)
- direccion (TextField, opcional)
- fecha_registro (DateTimeField, auto_now_add)

PROPIEDADES:
- nombre_completo (property) â†’ Retorna "nombre apellido"

CARACTERÃSTICAS:
- Ordenamiento: ['apellido', 'nombre']
- Sin constraint UNIQUE en nombre/apellido
- Sin constraint UNIQUE en telefono (pero validado en vistas)
- Sin constraint UNIQUE en email (pero validado en vistas)

RELACIONES:
- 1 Propietario puede tener N Pacientes (OneToMany vÃ­a FK en Paciente)
- Related name: 'mascotas' â†’ propietario.mascotas.all()

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MODELO 2: Paciente
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Archivo: pacientes/models.py (lÃ­neas 30-98)

ROL FUNCIONAL REAL:
Representa a las mascotas/animales que reciben atenciÃ³n veterinaria.
Es el modelo maestro de pacientes del sistema.

CAMPOS BÃSICOS:
- nombre (CharField, max_length=100)
- especie (CharField, choices: perro/gato/otro)
- raza (CharField, max_length=100, opcional)
- color (CharField, max_length=50, opcional)
- sexo (CharField, choices: M/H)
- microchip (CharField, max_length=50, opcional, UNIQUE)
- ultimo_peso (DecimalField, 6 dÃ­gitos, 2 decimales, opcional)
- activo (BooleanField, default=True) â†’ Soft delete
- fecha_registro (DateTimeField, auto_now_add)

CAMPOS DE EDAD (3 opciones):
- fecha_nacimiento (DateField, opcional)
- edad_anos (IntegerField, opcional)
- edad_meses (IntegerField, opcional)

ANTECEDENTES MÃ‰DICOS CRÃTICOS:
- alergias (TextField, opcional)
- enfermedades_cronicas (TextField, opcional)
- medicamentos_actuales (TextField, opcional)
- cirugia_previa (TextField, opcional)

RELACIÃ“N CON PROPIETARIO:
- propietario (ForeignKey â†’ Propietario, CASCADE, related_name='mascotas')

PROPIEDADES:
- edad_formateada (property) â†’ Calcula edad desde fecha_nacimiento o muestra estimado

CARACTERÃSTICAS:
- Ordenamiento: ['-fecha_registro'] (mÃ¡s recientes primero)
- Soft delete vÃ­a campo 'activo' (NO se eliminan fÃ­sicamente)
- Microchip UNIQUE constraint (permite null)

RELACIONES INVERSAS (de otras apps):
- consultas (from clinica.Consulta)
- hospitalizaciones (from clinica.Hospitalizacion)
- examenes (from clinica.Examen)
- documentos (from clinica.Documento)
- citas (from agenda.Cita)
- ventas (from caja.Venta)

================================================================================
2. USO REAL DE LOS MODELOS
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A. DÃ“NDE SE CREAN LOS REGISTROS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PROPIETARIO:
1. pacientes/views.py â†’ crear_paciente() (lÃ­nea 358)
   - Se crea junto con nuevo paciente si no existe
   - Valida duplicados antes de crear
   - Normaliza telÃ©fono chileno a formato +569XXXXXXXX

2. pacientes/views.py â†’ editar_paciente() (lÃ­nea 555, 637)
   - Se puede crear nuevo propietario al editar paciente
   - Permite cambiar paciente a nuevo propietario

PACIENTE:
1. pacientes/views.py â†’ crear_paciente() (lÃ­nea 414)
   - Formulario modal en interfaz de pacientes
   - Puede reutilizar propietario existente o crear nuevo
   - Calcula fecha_nacimiento desde edad estimada si es necesario
   - Endpoint: POST /pacientes/crear/

2. Administrativo:
   - Django Admin (aunque admin.py estÃ¡ vacÃ­o, se puede acceder)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
B. DÃ“NDE SE EDITAN LOS REGISTROS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

PROPIETARIO:
1. pacientes/views.py â†’ crear_paciente() (lÃ­nea 336-343)
   - Al crear paciente, si propietario existe, se puede actualizar
   - Flag: actualizar_propietario=True

2. pacientes/views.py â†’ editar_paciente() (lÃ­nea 612-615)
   - Al editar paciente, se puede actualizar info del propietario
   - Valida duplicados (telÃ©fono/email) antes de actualizar

PACIENTE:
1. pacientes/views.py â†’ editar_paciente() (lÃ­nea 445)
   - Modal de ediciÃ³n en ficha del paciente
   - Permite cambiar todos los campos incluyendo propietario
   - Endpoint: POST /pacientes/editar/<id>/

2. pacientes/views.py â†’ archivar_paciente() (lÃ­nea 659)
   - Toggle del campo 'activo' (soft delete)
   - Endpoint: POST /pacientes/archivar/<id>/

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
C. DÃ“NDE SE LEEN LOS REGISTROS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

EN LA PROPIA APP:

1. pacientes/views.py â†’ pacientes_view() (lÃ­nea 130)
   - Lista todos los pacientes (activos o archivados)
   - Filtro por estado: ?estado=activos o ?estado=archivados
   - Select_related('propietario') para optimizar
   - Endpoint: GET /pacientes/

2. pacientes/views.py â†’ ficha_mascota_view() (lÃ­nea 151)
   - Vista detallada del paciente
   - Carga consultas, citas, hospitalizaciones, examenes, documentos
   - Timeline unificado de eventos
   - Endpoint: GET /pacientes/<id>/

3. pacientes/views.py â†’ detalle_paciente() (lÃ­nea 290)
   - JSON con datos completos de paciente y propietario
   - Endpoint: GET /pacientes/detalle/<id>/

4. pacientes/views.py â†’ buscar_propietarios() (lÃ­nea 687)
   - BÃºsqueda de propietarios por nombre/apellido/telÃ©fono/email
   - Autocomplete, mÃ¡ximo 10 resultados
   - Endpoint: GET /pacientes/buscar_propietarios/?q=<query>

5. pacientes/views.py â†’ detalle_propietario() (lÃ­nea 714)
   - JSON con datos de un propietario especÃ­fico
   - Endpoint: GET /pacientes/propietarios/<id>/

EN OTRAS APPS:

AGENDA (app agenda):
- agenda/views.py lÃ­nea 86
  * Paciente.objects.filter(activo=True).select_related('propietario')
  * Para dropdown de selecciÃ³n en formulario de citas

- agenda/models.py lÃ­nea 236
  * Cita.paciente (FK a Paciente, CASCADE, related_name='citas')
  * Cada cita estÃ¡ vinculada a un paciente

CLÃNICA (app clinica):
- clinica/views.py lÃ­nea 9
  * from pacientes.models import Paciente
  * Usado en ficha_paciente(), crear_consulta(), etc.

- clinica/models.py:
  * Consulta.paciente (FK a Paciente, CASCADE, related_name='consultas')
  * Hospitalizacion.paciente (FK a Paciente, CASCADE, related_name='hospitalizaciones')
  * Examen.paciente (FK a Paciente, CASCADE, related_name='examenes')
  * Documento.paciente (FK a Paciente, CASCADE, related_name='documentos')

CAJA (app caja):
- caja/models.py lÃ­nea 169
  * Venta.paciente (FK a Paciente, PROTECT, optional, related_name='ventas')
  * Ventas pueden o no estar asociadas a un paciente

- caja/views_cobros.py lÃ­nea 212
  * Busca paciente para asociar a venta
  * Venta.objects.get(pk=paciente_id)

- caja/views_cobros.py lÃ­nea 242
  * Dropdown: Paciente.objects.filter(activo=True)

DASHBOARD (app dashboard):
- dashboard/views.py lÃ­nea 229
  * EstadÃ­sticas: Paciente.objects.filter(activo=True).count()
  * Total de pacientes activos

HOSPITAL (app hospital):
- hospital/models.py lÃ­nea 12
  * Hospitalizacion.idMascota (FK a Paciente, CASCADE)
  * NOTA: Este modelo parece legacy/duplicado con clinica.Hospitalizacion

- hospital/views.py lÃ­nea 11
  * EstadÃ­sticas: Paciente.objects.filter(activo=True).count()

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
D. LÃ“GICA DE VALIDACIÃ“N ESPECIAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

VALIDACIÃ“N DE PROPIETARIO DUPLICADO:
FunciÃ³n: validar_propietario_duplicado() (lÃ­nea 59)

Validaciones implementadas:
1. NOMBRE Y APELLIDO DUPLICADO (WARNING, no error):
   - Normaliza texto (sin tildes, minÃºsculas)
   - Compara con todos los propietarios
   - Retorna advertencia pero permite continuar si se confirma
   - Flag: ignore_name_warning=True para bypass

2. TELÃ‰FONO DUPLICADO (ERROR estricto):
   - Normaliza telÃ©fono a formato +569XXXXXXXX
   - NO permite crear/editar si existe
   - Retorna error con datos del propietario existente

3. EMAIL DUPLICADO (ERROR estricto):
   - ComparaciÃ³n case-insensitive
   - NO permite crear/editar si existe
   - Retorna error con datos del propietario existente

NORMALIZACIÃ“N DE TELÃ‰FONO:
FunciÃ³n: normalize_chile_phone() (lÃ­nea 28)
- Elimina caracteres no numÃ©ricos (excepto +)
- Agrega prefijo +56 si no existe
- Formato final: +569XXXXXXXX

NORMALIZACIÃ“N DE TEXTO:
FunciÃ³n: normalizar_texto() (lÃ­nea 48)
- Convierte a minÃºsculas
- Elimina tildes y diacrÃ­ticos
- Usado para comparaciÃ³n de nombres

CÃLCULO DE EDAD:
Propiedad: paciente.edad_formateada (lÃ­nea 75)
- Si tiene fecha_nacimiento: calcula edad exacta con relativedelta
- Si tiene edad_anos/meses: muestra "~X aÃ±os (estimado)"
- Si no tiene datos: "No especificada"
- Formato: "X aÃ±os y Y meses", "X aÃ±os", "Y meses", "Z dÃ­as"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
E. SIGNALS O LÃ“GICA IMPLÃCITA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

NO HAY SIGNALS.

Esta app NO define ni depende de signals de Django.
Toda la lÃ³gica es explÃ­cita en las vistas.

================================================================================
3. SOLAPAMIENTO CON OTRAS APPS
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ANÃLISIS DE DUPLICACIÃ“N
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

POSIBLE SOLAPAMIENTO DETECTADO:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modelo pacientes   â”‚ Modelo gestion    â”‚ Estado                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Propietario        â”‚ Cliente           â”‚ ğŸŸ  CONCEPTOS SIMILARES           â”‚
â”‚ Paciente           â”‚ Mascota           â”‚ ğŸŸ  CONCEPTOS SIMILARES           â”‚
â”‚ -                  â”‚ Consulta          â”‚ ğŸ”´ DUPLICADO con clinica         â”‚
â”‚ -                  â”‚ Agenda            â”‚ ğŸ”´ DUPLICADO con agenda          â”‚
â”‚ -                  â”‚ DocumentoMascota  â”‚ ğŸ”´ DUPLICADO con clinica         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DETALLE DE SOLAPAMIENTO:

1. PROPIETARIO vs CLIENTE (gestion.Cliente):

   pacientes.Propietario:
   - nombre, apellido (separados)
   - telefono, email, direccion
   - fecha_registro
   - Related: 'mascotas'

   gestion.Cliente:
   - rutCliente, dvCliente (campos RUT)
   - nombreCliente (nombre completo)
   - telCliente, emailCliente, direccion
   - NO tiene fecha_registro
   - Related: desconocido

   CONCLUSIÃ“N:
   - Son conceptos IDÃ‰NTICOS (dueÃ±o de mascota = cliente)
   - gestion.Cliente parece LEGACY/ANTIGUO
   - Estructura de gestion.Cliente es menos completa
   - pacientes.Propietario es el modelo ACTIVO

2. PACIENTE vs MASCOTA (gestion.Mascota):

   pacientes.Paciente:
   - Campos completos (especie, raza, color, sexo, fecha_nac, etc.)
   - Antecedentes mÃ©dicos (alergias, enfermedades, cirugÃ­as)
   - Soft delete (campo 'activo')
   - FK a Propietario
   - MÃºltiples related_names de otras apps

   gestion.Mascota:
   - Campos bÃ¡sicos (nombreMascota, animal_mascota, raza_mascota)
   - edad (IntegerField simple)
   - peso (FloatField simple)
   - FK a Cliente
   - NO tiene antecedentes mÃ©dicos

   CONCLUSIÃ“N:
   - Son conceptos IDÃ‰NTICOS (mascota = paciente veterinario)
   - gestion.Mascota parece LEGACY/ANTIGUO
   - pacientes.Paciente es MUCHO mÃ¡s completo
   - pacientes.Paciente es el modelo ACTIVO

3. VERIFICACIÃ“N DE USO:

   App GESTION:
   - NO hay vistas que usen estos modelos
   - NO hay templates en uso
   - NO hay referencias desde otras apps
   - gestion/views.py NO importa estos modelos

   App PACIENTES:
   - Vistas completas y funcionales
   - Importada por: agenda, clinica, caja, dashboard, hospital
   - Templates activos
   - URLs activas

VEREDICTO:
ğŸŸ¢ NO HAY SOLAPAMIENTO ACTIVO
- gestion.Cliente y gestion.Mascota son modelos LEGACY INACTIVOS
- pacientes.Propietario y pacientes.Paciente son los modelos ACTIVOS
- NO conviven en uso real (solo en estructura de BD)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
VERIFICACIÃ“N EN HOSPITAL APP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

hospital/models.py tiene un modelo Hospitalizacion que usa Paciente:
- from pacientes.models import Paciente
- Hospitalizacion.idMascota = FK(Paciente, CASCADE)

NOTA: Este modelo parece estar DUPLICADO con clinica.Hospitalizacion
(Ver anÃ¡lisis de app "clinica" para mÃ¡s detalles)

================================================================================
4. DEPENDENCIAS CRÃTICAS CON OTRAS APPS
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ App             â”‚ Tipo Dependencia   â”‚ DescripciÃ³n                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ agenda          â”‚ ğŸ”´ CRÃTICA        â”‚ Cita.paciente (FK CASCADE)         â”‚
â”‚ clinica         â”‚ ğŸ”´ CRÃTICA        â”‚ 4 modelos con FK (Consulta, etc)   â”‚
â”‚ caja            â”‚ ğŸŸ  ALTA           â”‚ Venta.paciente (FK PROTECT)        â”‚
â”‚ dashboard       â”‚ ğŸŸ¡ MEDIA          â”‚ EstadÃ­sticas de pacientes          â”‚
â”‚ hospital        â”‚ ğŸŸ  ALTA (legacy)  â”‚ Hospitalizacion.idMascota (FK)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DETALLE DE DEPENDENCIAS:

A. APP AGENDA (ğŸ”´ CRÃTICA):
   - agenda/models.py lÃ­nea 236
     * Cita.paciente (ForeignKey a Paciente, CASCADE)
   - agenda/views.py lÃ­nea 86
     * Dropdown de pacientes para crear citas
   - Impacto: SIN pacientes NO hay agendamiento

B. APP CLÃNICA (ğŸ”´ CRÃTICA):
   - clinica/models.py:
     * Consulta.paciente (FK a Paciente, CASCADE, related_name='consultas')
     * Hospitalizacion.paciente (FK a Paciente, CASCADE, related_name='hospitalizaciones')
     * Examen.paciente (FK a Paciente, CASCADE, related_name='examenes')
     * Documento.paciente (FK a Paciente, CASCADE, related_name='documentos')
   - clinica/views.py:
     * Varias vistas cargan datos de paciente
     * Ficha clÃ­nica depende 100% de Paciente
   - Impacto: SIN pacientes NO hay atenciÃ³n clÃ­nica

C. APP CAJA (ğŸŸ  ALTA):
   - caja/models.py lÃ­nea 169
     * Venta.paciente (FK a Paciente, PROTECT, opcional)
   - caja/views_cobros.py
     * Dropdowns y bÃºsqueda de pacientes
     * AsociaciÃ³n opcional de ventas a pacientes
   - Impacto: Ventas pueden existir sin paciente, pero se pierde trazabilidad

D. APP DASHBOARD (ğŸŸ¡ MEDIA):
   - dashboard/views.py lÃ­nea 229
     * Total de pacientes activos (estadÃ­stica)
   - Impacto: Solo estadÃ­sticas, no funcionalidad core

E. APP HOSPITAL (ğŸŸ  ALTA pero LEGACY):
   - hospital/models.py lÃ­nea 12
     * Hospitalizacion.idMascota (FK a Paciente, CASCADE)
   - hospital/views.py lÃ­nea 11
     * EstadÃ­sticas
   - NOTA: Parece duplicado con clinica.Hospitalizacion

TOTAL DE FOREIGNKEYS A PACIENTE:
- agenda.Cita: 1
- clinica.Consulta: 1
- clinica.Hospitalizacion: 1
- clinica.Examen: 1
- clinica.Documento: 1
- caja.Venta: 1 (opcional)
- hospital.Hospitalizacion: 1 (legacy?)
TOTAL: 7 ForeignKeys activas

IMPACTO SI SE ELIMINA PACIENTES:
- ğŸ”´ IMPOSIBLE: Toda la clÃ­nica depende de pacientes
- ğŸ”´ NO HAY ALTERNATIVA: Es el modelo maestro del sistema
- ğŸ”´ MIGRACIONES COMPLEJAS: 7 modelos dependen de Ã©l

================================================================================
5. CAMPOS O MODELOS POCO USADOS
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A. CAMPOS CON USO COMPLETO EN PACIENTE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… nombre - Usado en todas partes
âœ… especie - Usado en listados y fichas
âœ… sexo - Usado en fichas
âœ… propietario - FK crÃ­tica
âœ… activo - Soft delete funcional
âœ… fecha_registro - Ordenamiento y auditorÃ­a

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
B. CAMPOS CON USO MEDIO/ALTO EN PACIENTE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸŸ¡ raza - Capturado pero poco usado en lÃ³gica
ğŸŸ¡ color - Capturado pero poco usado en lÃ³gica
ğŸŸ¡ fecha_nacimiento / edad_anos / edad_meses - Uno de los 3 se usa
ğŸŸ¡ ultimo_peso - Usado en fichas clÃ­nicas
ğŸŸ¡ microchip - Opcional, UNIQUE constraint

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
C. CAMPOS CRÃTICOS PERO OPCIONALES EN PACIENTE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš ï¸ alergias - CRÃTICO para atenciÃ³n mÃ©dica, pero opcional
âš ï¸ enfermedades_cronicas - CRÃTICO para atenciÃ³n mÃ©dica, pero opcional
âš ï¸ medicamentos_actuales - CRÃTICO para prescripciÃ³n, pero opcional
âš ï¸ cirugia_previa - IMPORTANTE para historial, pero opcional

PROBLEMA DETECTADO:
Estos campos son CRÃTICOS para la seguridad del paciente (ej: alergias)
pero son opcionales y pueden quedar vacÃ­os.

RECOMENDACIÃ“N (solo anÃ¡lisis, no implementar):
- Considerar hacer OBLIGATORIO el campo 'alergias' (aunque sea "Ninguna")
- Agregar validaciÃ³n en interfaz para recordar llenar antecedentes

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
D. CAMPOS EN PROPIETARIO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… nombre, apellido - CRÃTICOS
ğŸŸ¡ telefono - Validado como Ãºnico en vistas, MUY usado
ğŸŸ¡ email - Validado como Ãºnico en vistas, usado medio
ğŸŸ¢ direccion - Poco usado en el sistema
âœ… fecha_registro - AuditorÃ­a

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
E. FUNCIONALIDAD COMPLETA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… Crear paciente - Funcional
âœ… Editar paciente - Funcional
âœ… Archivar paciente - Funcional (soft delete)
âœ… Buscar propietarios - Funcional (autocomplete)
âœ… ValidaciÃ³n de duplicados - Funcional y robusta
âœ… NormalizaciÃ³n de telÃ©fonos - Funcional
âœ… CÃ¡lculo de edad - Funcional

NO SE DETECTARON FUNCIONALIDADES SIN USO

================================================================================
6. NIVEL DE RIESGO
================================================================================

ğŸ”´ CRÃTICA - ABSOLUTAMENTE NO TOCAR

RAZONES:

1. ES EL MODELO MAESTRO DEL SISTEMA VETERINARIO
   - Toda la operaciÃ³n gira alrededor de Paciente y Propietario
   - Sin pacientes NO HAY servicio veterinario

2. MÃšLTIPLES FOREIGNKEYS EN TODA LA BASE DE DATOS
   - 7 ForeignKeys activas de diferentes apps
   - agenda: Cita (CASCADE)
   - clinica: Consulta, Hospitalizacion, Examen, Documento (todos CASCADE)
   - caja: Venta (PROTECT)
   - hospital: Hospitalizacion (CASCADE, legacy)

3. RELACIONNAME USADO EXTENSIVAMENTE
   - paciente.consultas.all()
   - paciente.citas.all()
   - paciente.hospitalizaciones.all()
   - paciente.examenes.all()
   - paciente.documentos.all()
   - paciente.ventas.all()
   - propietario.mascotas.all()

4. VISTAS COMPLETAS Y FUNCIONALES
   - 8 endpoints activos
   - IntegraciÃ³n con todas las apps principales
   - Templates en uso

5. MIGRACIONES APLICADAS
   - MigraciÃ³n inicial 0001_initial.py
   - Dependencia en mÃºltiples apps (0002_initial.py de otras apps)

IMPACTO SI SE MODIFICA:
- ğŸ”´ CRÃTICO: Cambiar estructura requiere migraciÃ³n compleja
- ğŸ”´ CRÃTICO: Renombrar campos rompe 7 modelos en 5 apps
- ğŸ”´ CRÃTICO: Cambiar FK rompe toda la clÃ­nica
- ğŸ”´ CRÃTICO: Eliminar campos puede perder datos mÃ©dicos crÃ­ticos

IMPACTO SI SE ELIMINA:
âŒ IMPOSIBLE - Es el corazÃ³n del sistema

FACILIDAD DE REFACTORIZACIÃ“N:
ğŸ”´ MUY DIFÃCIL
- 7 modelos con FK en 5 apps diferentes
- Related names usados en mÃºltiples lugares
- LÃ³gica de validaciÃ³n compleja
- Templates que dependen de estructura especÃ­fica

================================================================================
7. PROBLEMAS DETECTADOS
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A. SEGURIDAD MÃ‰DICA - ANTECEDENTES OPCIONALES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Problema: Campos crÃ­ticos son opcionales
Riesgo: ALTO - Alergias no registradas pueden causar reacciones graves
UbicaciÃ³n: pacientes/models.py lÃ­neas 58-61
Campos afectados:
- alergias
- enfermedades_cronicas
- medicamentos_actuales
- cirugia_previa

Impacto: Posible error mÃ©dico por falta de informaciÃ³n

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
B. INTEGRIDAD DE DATOS - VALIDACIÃ“N SOLO EN VISTAS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Problema: ValidaciÃ³n de unicidad (telÃ©fono, email) solo en vistas
Riesgo: MEDIO - Posible crear duplicados desde Django Admin o scripts
UbicaciÃ³n: pacientes/views.py lÃ­nea 59
SoluciÃ³n ideal: Agregar UNIQUE constraints en modelo o validaciÃ³n en save()

Impacto: Inconsistencia de datos

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
C. ADMIN VACÃO
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Problema: pacientes/admin.py estÃ¡ completamente vacÃ­o
Riesgo: BAJO - Dificulta administraciÃ³n desde Django Admin
UbicaciÃ³n: pacientes/admin.py
Impacto: No se puede administrar pacientes desde /admin/

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
D. EDAD CALCULADA EN RUNTIME
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Problema: edad_formateada es property, no campo calculado
Riesgo: BAJO - Puede ser lento con muchos pacientes
UbicaciÃ³n: pacientes/models.py lÃ­nea 75
Impacto: Performance en listados grandes

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
E. POSIBLE LEGACY EN HOSPITAL APP
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Problema: hospital.Hospitalizacion parece duplicar clinica.Hospitalizacion
Riesgo: MEDIO - ConfusiÃ³n sobre cuÃ¡l usar
UbicaciÃ³n: hospital/models.py lÃ­nea 12
Impacto: Deuda tÃ©cnica, mantenimiento duplicado

================================================================================
8. ANÃLISIS DE VISTAS Y ENDPOINTS
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Endpoint                    â”‚ MÃ©todo      â”‚ FunciÃ³n                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /pacientes/                 â”‚ GET         â”‚ Lista pacientes activos      â”‚
â”‚ /pacientes/?estado=...      â”‚ GET         â”‚ Filtro activos/archivados    â”‚
â”‚ /pacientes/<id>/            â”‚ GET         â”‚ Ficha completa del paciente  â”‚
â”‚ /pacientes/detalle/<id>/    â”‚ GET         â”‚ JSON detalle paciente        â”‚
â”‚ /pacientes/crear/           â”‚ POST        â”‚ Crear nuevo paciente         â”‚
â”‚ /pacientes/editar/<id>/     â”‚ POST        â”‚ Editar paciente existente    â”‚
â”‚ /pacientes/archivar/<id>/   â”‚ POST        â”‚ Archivar/desarchivar         â”‚
â”‚ /buscar_propietarios/       â”‚ GET         â”‚ Autocomplete propietarios    â”‚
â”‚ /propietarios/<id>/         â”‚ GET         â”‚ JSON detalle propietario     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TODOS LOS ENDPOINTS ESTÃN ACTIVOS Y FUNCIONALES

DECORADORES:
- @login_required en todas las vistas
- @csrf_exempt en vistas POST de API
- @require_http_methods en editar_paciente

VALIDACIONES IMPLEMENTADAS:
âœ… Propietario duplicado (nombre, telÃ©fono, email)
âœ… Fecha de nacimiento no puede ser futura
âœ… NormalizaciÃ³n de telÃ©fonos chilenos
âœ… Microchip Ãºnico (constraint en modelo)
âœ… BÃºsqueda mÃ­nimo 2 caracteres

================================================================================
9. ANÃLISIS DE TEMPLATES
================================================================================

TEMPLATES DETECTADOS:
- pacientes/templates/pacientes/pacientes.html
  * Lista de pacientes con tabla
  * Botones de crear, editar, archivar
  * Filtro activos/archivados

- clinica/templates/consulta/ficha_mascota.html
  * Ficha completa del paciente
  * Timeline de eventos (citas + consultas)
  * InformaciÃ³n de propietario
  * Antecedentes mÃ©dicos

CARACTERÃSTICAS:
- Select_related('propietario') usado para optimizar queries
- Prefetch_related('medicamentos') para consultas
- Uso de paciente.edad_formateada en mÃºltiples lugares

================================================================================
10. CONCLUSIÃ“N DE LA APP
================================================================================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ESTADO ACTUAL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
La app "pacientes" es el NÃšCLEO MAESTRO del sistema veterinario.
Define los modelos Propietario y Paciente, que son referenciados por
TODAS las apps principales del sistema (agenda, clinica, caja, etc.).

Sin esta app, el sistema veterinario NO PUEDE FUNCIONAR.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â¿DEBE QUEDARSE TAL CUAL?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… SÃ - ABSOLUTAMENTE

Razones para NO tocar:
- âœ… Es el modelo maestro del sistema completo
- âœ… 7 ForeignKeys de 5 apps diferentes dependen de ella
- âœ… Funcionalidad completa y bien diseÃ±ada
- âœ… Validaciones robustas implementadas
- âœ… Sin bugs crÃ­ticos detectados
- âœ… Estructura lÃ³gica y clara
- âœ… Performance adecuada

Razones para mantener estructura:
- âœ… Propietario y Paciente son entidades claramente diferenciadas
- âœ… Soft delete con campo 'activo' es correcto
- âœ… Antecedentes mÃ©dicos estÃ¡n bien ubicados
- âœ… Propiedad edad_formateada es Ãºtil y clara

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â¿DEBE REFACTORIZARSE EN EL FUTURO?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸŸ¡ MEJORAS MENORES (no urgente, no crÃ­tico)

MEJORAS RECOMENDADAS (solo anÃ¡lisis):

PRIORIDAD ALTA (Seguridad):
1. Agregar validaciÃ³n/advertencia si 'alergias' estÃ¡ vacÃ­o
   - No hacer obligatorio, pero mostrar alerta
   - Considerar checkbox "Confirmo que no tiene alergias"

2. Mover validaciÃ³n de unicidad a modelo
   - Agregar clean() en Propietario para validar telÃ©fono/email
   - Esto previene duplicados desde Admin o scripts

PRIORIDAD MEDIA (Calidad):
3. Registrar modelos en admin.py
   - PropietarioAdmin con bÃºsqueda y filtros
   - PacienteAdmin con bÃºsqueda y filtros

4. Agregar Ã­ndices adicionales
   - Index en Propietario.telefono (bÃºsquedas frecuentes)
   - Index en Propietario.email (bÃºsquedas frecuentes)
   - Index en Paciente.activo (filtros frecuentes)

5. Considerar campo calculado para edad
   - Evitar cÃ¡lculo en runtime si hay performance issues
   - Usar annotate() en querysets grandes

PRIORIDAD BAJA (OptimizaciÃ³n):
6. Evaluar eliminar app "hospital" si es legacy
   - Verificar si hospital.Hospitalizacion se usa
   - Migrar datos a clinica.Hospitalizacion si es necesario

7. Considerar agregar mÃ¡s antecedentes mÃ©dicos
   - Vacunas (tabla separada con fechas)
   - EsterilizaciÃ³n (boolean + fecha)
   - Grupo sanguÃ­neo (si aplica)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Â¿PUEDE ELIMINARSE?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âŒ ABSOLUTAMENTE NO

Es IMPOSIBLE eliminar esta app porque:
- ğŸ”´ Es el modelo maestro de pacientes/clientes
- ğŸ”´ 7 modelos en 5 apps tienen FK a Paciente
- ğŸ”´ Toda la lÃ³gica de negocio depende de ella
- ğŸ”´ No hay modelo alternativo que pueda reemplazarla
- ğŸ”´ Eliminarla = eliminar todo el sistema veterinario

ALTERNATIVAS (ninguna viable):
- Fusionar con otra app: NO, otras apps dependen de esta
- Reemplazar con gestion.Mascota: NO, es legacy e incompleto
- Crear nueva app: NO, requerirÃ­a migraciÃ³n masiva

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RELACIÃ“N CON APP "GESTION"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
gestion.Cliente y gestion.Mascota son modelos LEGACY INACTIVOS:
- NO se usan en vistas
- NO se importan en otras apps
- NO tienen URLs activas
- Son versiÃ³n antigua del sistema

pacientes.Propietario y pacientes.Paciente son los modelos ACTIVOS:
- Usados por todas las apps
- Estructura completa y moderna
- Validaciones robustas
- IntegraciÃ³n total

RECOMENDACIÃ“N:
- Mantener pacientes como estÃ¡
- Evaluar eliminaciÃ³n de gestion.Cliente y gestion.Mascota en futuro
  (requiere anÃ¡lisis de app "gestion" completo)

================================================================================
11. RECOMENDACIONES FINALES
================================================================================

ACCIÃ“N INMEDIATA (HOY):
âœ… MANTENER la app exactamente como estÃ¡
âœ… NO modificar estructura de modelos
âœ… NO cambiar nombres de campos
âœ… NO agregar/eliminar ForeignKeys

MEJORAS FUTURAS (PRIORIDAD BAJA):
â–¡ Agregar PropietarioAdmin y PacienteAdmin
â–¡ Agregar validaciÃ³n clean() para unicidad de telÃ©fono/email
â–¡ Agregar Ã­ndices en campos de bÃºsqueda frecuente
â–¡ Considerar alerta si 'alergias' estÃ¡ vacÃ­o
â–¡ Documentar campos crÃ­ticos de antecedentes mÃ©dicos

NO HACER (PROHIBIDO):
âŒ NO eliminar esta app
âŒ NO renombrar modelos Propietario o Paciente
âŒ NO cambiar campo 'propietario' en Paciente
âŒ NO cambiar on_delete de ForeignKeys
âŒ NO eliminar campos (pueden tener datos en producciÃ³n)
âŒ NO fusionar con gestion.Cliente/Mascota

================================================================================
12. RESUMEN EJECUTIVO
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aspecto                 â”‚ EvaluaciÃ³n                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nivel de Riesgo         â”‚ ğŸ”´ CRÃTICA - ABSOLUTAMENTE NO TOCAR     â”‚
â”‚ Modelos                 â”‚ 2 (Propietario, Paciente)                â”‚
â”‚ ForeignKeys entrantes   â”‚ 7 de 5 apps diferentes                   â”‚
â”‚ Solapamiento            â”‚ ğŸŸ¢ No (gestion es legacy inactivo)       â”‚
â”‚ Estado Funcional        â”‚ ğŸŸ¢ Excelente, sin bugs crÃ­ticos          â”‚
â”‚ Completitud             â”‚ ğŸŸ¢ 100% funcional y completa             â”‚
â”‚ Performance             â”‚ ğŸŸ¢ Buena, con optimizaciones             â”‚
â”‚ Seguridad               â”‚ ğŸŸ¡ Buena, mejoras menores sugeridas      â”‚
â”‚ Facilidad Refactorizar  â”‚ ğŸ”´ MUY DIFÃCIL (7 FK en 5 apps)          â”‚
â”‚ Puede eliminarse        â”‚ âŒ IMPOSIBLE - Es el core del sistema    â”‚
â”‚ AcciÃ³n recomendada      â”‚ âœ… MANTENER sin cambios                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

VEREDICTO FINAL:
La app "pacientes" es PERFECTA tal como estÃ¡. Es el modelo maestro del
sistema veterinario y estÃ¡ bien diseÃ±ada, completa y funcional. NO
requiere refactorizaciÃ³n mayor. Solo mejoras cosmÃ©ticas menores opcionales.

DEPENDENCIAS CRÃTICAS:
- agenda â†’ Cita.paciente
- clinica â†’ Consulta, Hospitalizacion, Examen, Documento
- caja â†’ Venta.paciente
- dashboard â†’ estadÃ­sticas
- hospital â†’ Hospitalizacion (legacy)

IMPORTANCIA EN EL SISTEMA: â­â­â­â­â­ (5/5)
Es el modelo mÃ¡s importante del sistema completo.

================================================================================
FIN DEL ANÃLISIS
================================================================================
