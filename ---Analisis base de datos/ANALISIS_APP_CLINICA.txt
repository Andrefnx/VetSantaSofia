================================================================================
ANÃLISIS DIAGNÃ“STICO: APP CLINICA
================================================================================
Proyecto: VetSantaSofia
Fecha: 15 de diciembre de 2025
Modo: Solo anÃ¡lisis - Sin modificaciones

================================================================================
1. MODELOS - ARQUITECTURA Y ROL FUNCIONAL
================================================================================

1.1. Consulta
--------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 8-48)

DefiniciÃ³n:
Modelo para registro de consultas veterinarias. Almacena informaciÃ³n clÃ­nica
de cada atenciÃ³n mÃ©dica.

Campos principales:
- paciente: FK a Paciente (CASCADE)
- veterinario: FK a CustomUser (SET_NULL)
- fecha: DateTimeField (auto now)
- tipo_consulta: CharField con choices:
  * consulta_general, urgencia, vacuna, desparacitacion, control, cirugia, otros
- Signos vitales: temperatura, peso, frecuencia_cardiaca, frecuencia_respiratoria
- diagnostico: TextField (obligatorio)
- tratamiento: TextField (opcional)
- notas: TextField (opcional)

Relaciones M2M:
- medicamentos: ManyToManyField con Insumo (relacionado 'consultas_usadas')
- servicios: ManyToManyField con Servicio (relacionado 'consultas')

Method Ãºtil:
- servicios_nombres(): Retorna nombres de servicios o tipo_consulta_display

Rol funcional real:
âœ“ Registro clÃ­nico: Almacena informaciÃ³n mÃ©dica de cada atenciÃ³n
âœ“ Historial: Genera timeline del paciente
âœ“ IntegraciÃ³n con agenda: Marca cita como completada al crear consulta
âœ“ FacturaciÃ³n: Genera cobro pendiente automÃ¡ticamente (via signal)
âœ“ Trazabilidad: QuiÃ©n atendiÃ³, quÃ© se hizo, quÃ© se usÃ³

Vistas que lo usan:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vista                          â”‚ FunciÃ³n                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ficha_paciente()               â”‚ Muestra consultas en historial   â”‚
â”‚ ficha_mascota()                â”‚ Muestra consultas en timeline    â”‚
â”‚ crear_consulta()               â”‚ Crea nueva consulta              â”‚
â”‚ detalle_consulta()             â”‚ Obtiene detalles de consulta     â”‚
â”‚ guardar_consulta()             â”‚ Crea consulta (duplicado?)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Dependencias de otras apps:

â–¸ ForeignKey DESDE Consulta:
  1. pacientes.Paciente â†’ consulta.paciente (CASCADE)
  2. cuentas.CustomUser â†’ consulta.veterinario (SET_NULL)

â–¸ ManyToMany DESDE Consulta:
  3. inventario.Insumo â†’ consulta.medicamentos
  4. servicios.Servicio â†’ consulta.servicios

â–¸ OneToOne HACIA Consulta:
  5. caja.Venta â†’ consulta (OneToOneField, related_name='venta')

â–¸ Usado POR otras apps:
  1. caja.services.crear_cobro_pendiente_desde_consulta()
     - Lee consulta.servicios para generar lÃ­neas de venta
     - Lee consulta.insumos_detalle para facturar insumos
     
  2. clinica.signals.crear_cobro_desde_consulta
     - Signal post_save que crea cobro automÃ¡ticamente
     - Se activa al guardar Consulta con servicios/insumos
     
  3. pacientes.views.obtener_consultas_recientes()
     - Lee consultas para mostrar en perfil de paciente

Impacto en operaciones crÃ­ticas:
âœ“ ClÃ­nica: Es el CENTRO del registro mÃ©dico
âœ“ Caja: Genera cobros automÃ¡ticamente
âœ“ Inventario: Registra uso de insumos (sin descontar stock automÃ¡tico)
âœ“ Agenda: IntegraciÃ³n manual para marcar cita completada

Estado: âœ… ACTIVO Y CRÃTICO - Centro del registro clÃ­nico


1.2. MedicamentoUtilizado
--------------------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 51-63)

DefiniciÃ³n:
Tabla intermedia para registrar medicamentos usados en consultas.
Complementa la relaciÃ³n M2M Consulta â†” Insumo.

Campos principales:
- consulta: FK a Consulta (CASCADE)
- inventario_id: IntegerField (ID del insumo)
- nombre: CharField (nombre del medicamento)
- dosis: CharField (dosis administrada)
- peso_paciente: DecimalField (peso al momento)
- fecha_registro: DateTimeField (auto)

Rol funcional real:
âœ“ Detalle de medicaciÃ³n: Almacena dosis especÃ­fica administrada
âœ“ Complemento: Extiende M2M medicamentos con datos adicionales
âœ“ Historial: Trazabilidad de quÃ© medicamento, cuÃ¡nto, cuÃ¡ndo

âš  IMPORTANTE: Modelo LEGACY - Existe ConsultaInsumo mÃ¡s completo

Vistas que lo usan:
- crear_consulta(): Crea registros MedicamentoUtilizado
- detalle_consulta(): Lee medicamentos_detalle

Estado: ğŸŸ  LEGACY/TRANSICIÃ“N - Existe modelo mÃ¡s moderno (ConsultaInsumo)


1.3. Hospitalizacion
---------------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 66-114)

DefiniciÃ³n:
Modelo para hospitalizaciones. Representa ingreso del paciente a internaciÃ³n.

Campos principales:
- paciente: FK a Paciente (CASCADE)
- veterinario: FK a CustomUser (SET_NULL)
- fecha_ingreso: DateTimeField
- fecha_alta: DateTimeField (nullable)
- motivo: TextField
- diagnostico_hosp: TextField
- estado: CharField con choices:
  * activa, alta, fallecido
- observaciones: TextField

RelaciÃ³n M2M:
- insumos: ManyToManyField con Insumo (relacionado 'hospitalizaciones_usadas')

ValidaciÃ³n crÃ­tica:
- clean(): Valida que NO haya otra hospitalizaciÃ³n activa para mismo paciente
- Solo puede haber UNA hospitalizaciÃ³n activa por paciente

Rol funcional real:
âœ“ InternaciÃ³n: Registro de pacientes hospitalizados
âœ“ Seguimiento: Estado actual de hospitalizaciÃ³n
âœ“ Contenedor: Agrupa cirugÃ­as, registros diarios, alta mÃ©dica
âœ“ FacturaciÃ³n: Genera cobro al dar de alta (via signal)

Vistas que lo usan:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vista                           â”‚ FunciÃ³n                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ crear_hospitalizacion()         â”‚ Crea nueva hospitalizaciÃ³n      â”‚
â”‚ obtener_hospitalizaciones()     â”‚ Lista hospitalizaciones         â”‚
â”‚ detalle_hospitalizacion()       â”‚ Detalles de hospitalizaciÃ³n     â”‚
â”‚ dashboard (admin/veterinario)   â”‚ Hospitalizaciones activas       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Dependencias:

â–¸ ForeignKey DESDE Hospitalizacion:
  1. pacientes.Paciente â†’ hospitalizacion.paciente (CASCADE)
  2. cuentas.CustomUser â†’ hospitalizacion.veterinario (SET_NULL)

â–¸ OneToOne HACIA Hospitalizacion:
  3. caja.Venta â†’ hospitalizacion (OneToOneField)
  4. Alta â†’ hospitalizacion (OneToOneField)

â–¸ ForeignKey HACIA Hospitalizacion:
  5. Cirugia â†’ hospitalizacion (CASCADE)
  6. RegistroDiario â†’ hospitalizacion (CASCADE)

â–¸ Usado POR otras apps:
  1. caja.services.crear_cobro_pendiente_desde_hospitalizacion()
     - Lee cirugÃ­as, insumos para generar cobro al alta
     
  2. clinica.signals.crear_cobro_desde_hospitalizacion
     - Signal que se activa cuando estado='alta'
     
  3. dashboard.views (admin y veterinario)
     - Muestra hospitalizaciones activas
     - EstadÃ­sticas de pacientes hospitalizados

Impacto en operaciones crÃ­ticas:
âœ“ ClÃ­nica: Control de pacientes internados
âœ“ Caja: Genera factura completa al alta
âœ“ Reportes: EstadÃ­sticas de hospitalizaciones

Estado: âœ… ACTIVO Y CRÃTICO - Centro de internaciÃ³n


1.4. Cirugia
-------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 117-147)

DefiniciÃ³n:
Modelo para cirugÃ­as realizadas dentro de una hospitalizaciÃ³n.

Campos principales:
- hospitalizacion: FK a Hospitalizacion (CASCADE)
- servicio: FK a Servicio (SET_NULL, opcional)
- fecha_cirugia: DateTimeField
- veterinario_cirujano: FK a CustomUser (SET_NULL)
- tipo_cirugia: CharField
- descripcion: TextField
- duracion_minutos: IntegerField
- anestesiologo: CharField
- tipo_anestesia: CharField
- complicaciones: TextField
- resultado: CharField con choices:
  * '', exitosa, con_complicaciones, problemas

RelaciÃ³n M2M:
- medicamentos: ManyToManyField con Insumo (relacionado 'cirugias_usadas')

Rol funcional real:
âœ“ Registro quirÃºrgico: Detalle de procedimientos quirÃºrgicos
âœ“ Trazabilidad: QuiÃ©n operÃ³, quÃ© se hizo, resultado
âœ“ FacturaciÃ³n: Servicio de cirugÃ­a se cobra en factura de hospitalizaciÃ³n
âœ“ Insumos: Registra materiales usados en cirugÃ­a

Vistas que lo usan:
- crear_cirugia(): Crea registro de cirugÃ­a

Dependencias:

â–¸ ForeignKey DESDE Cirugia:
  1. Hospitalizacion â†’ cirugia.hospitalizacion (CASCADE)
  2. servicios.Servicio â†’ cirugia.servicio (SET_NULL)
  3. cuentas.CustomUser â†’ cirugia.veterinario_cirujano (SET_NULL)

â–¸ Usado POR caja:
  - crear_cobro_pendiente_desde_hospitalizacion() lee cirugias.all()
  - Cobra servicio si cirugia.servicio existe

Impacto:
âœ“ ClÃ­nica: Registro de procedimientos
âœ“ Caja: FacturaciÃ³n de cirugÃ­a como servicio

Estado: âœ… ACTIVO - Parte del flujo de hospitalizaciÃ³n


1.5. RegistroDiario
--------------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 150-167)

DefiniciÃ³n:
Registro diario durante hospitalizaciÃ³n. Seguimiento del paciente internado.

Campos principales:
- hospitalizacion: FK a Hospitalizacion (CASCADE)
- fecha_registro: DateTimeField
- temperatura: DecimalField (obligatorio)
- peso: DecimalField (opcional)
- frecuencia_cardiaca: IntegerField (opcional)
- frecuencia_respiratoria: IntegerField (opcional)
- observaciones: TextField

RelaciÃ³n M2M:
- medicamentos: ManyToManyField con Insumo (relacionado 'registros_usados')

Rol funcional real:
âœ“ Seguimiento: EvoluciÃ³n diaria del paciente
âœ“ Signos vitales: Temperatura obligatoria, otros opcionales
âœ“ MedicaciÃ³n: Registro de medicamentos administrados diariamente

Vistas que lo usan:
- crear_registro_diario(): Crea nuevo registro
- dashboard muestra conteo de registros

Estado: âœ… ACTIVO - Seguimiento hospitalario


1.6. Alta
----------
UbicaciÃ³n: clinica/models.py (lÃ­neas 170-184)

DefiniciÃ³n:
Resumen de alta mÃ©dica al finalizar hospitalizaciÃ³n.

Campos principales:
- hospitalizacion: OneToOneField a Hospitalizacion (CASCADE)
- fecha_alta: DateTimeField
- diagnostico_final: TextField
- tratamiento_post_alta: TextField
- recomendaciones: TextField
- proxima_revision: DateField (nullable)

Rol funcional real:
âœ“ Cierre: Documento de alta mÃ©dica
âœ“ Seguimiento: Indica prÃ³xima revisiÃ³n
âœ“ Recomendaciones: Instrucciones post-hospitalizaciÃ³n

Vistas que lo usan:
- crear_alta_medica(): Crea alta

RelaciÃ³n con Hospitalizacion:
- OneToOne: Cada hospitalizaciÃ³n tiene mÃ¡ximo una alta
- Al crear alta, cambia estado de hospitalizaciÃ³n

Estado: âœ… ACTIVO - Cierre de hospitalizaciÃ³n


1.7. Examen
------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 187-199)

DefiniciÃ³n:
Modelo para exÃ¡menes mÃ©dicos y resultados.

Campos principales:
- paciente: FK a Paciente (CASCADE)
- veterinario: FK a CustomUser (SET_NULL)
- fecha: DateField
- tipo: CharField (tipo de examen)
- resultado: TextField
- archivo: FileField (upload_to='examenes/')

Rol funcional real:
âœ“ Resultados: Almacena resultados de laboratorio, imÃ¡genes, etc.
âœ“ Archivos: Guarda PDFs, imÃ¡genes de exÃ¡menes
âœ“ Historial: Timeline de exÃ¡menes del paciente

Vistas: No hay vistas especÃ­ficas en clinica.views
Estado: ğŸŸ  DEFINIDO PERO SIN CRUD ACTIVO


1.8. Documento
---------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 202-217)

DefiniciÃ³n:
Documentos adjuntos del paciente.

Campos principales:
- paciente: FK a Paciente (CASCADE)
- nombre: CharField
- descripcion: TextField
- archivo: FileField (upload_to='documentos/')
- fecha_subida: DateTimeField (auto)

Rol funcional real:
âœ“ Adjuntos: Documentos varios del paciente
âœ“ GestiÃ³n: Subir, descargar, eliminar documentos

Vistas que lo usan:
- subir_documento()
- descargar_documento()
- eliminar_documento()

Estado: âœ… ACTIVO - GestiÃ³n documental


1.9. ConsultaInsumo (NUEVO)
----------------------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 223-300)

DefiniciÃ³n:
Tabla intermedia moderna para registrar insumos usados en consultas
con cÃ¡lculo automÃ¡tico de cantidad basado en dosis y peso.

Campos principales:
- consulta: FK a Consulta (CASCADE)
- insumo: FK a Insumo (PROTECT)
- Datos de cÃ¡lculo:
  * peso_paciente: DecimalField
  * dosis_ml_por_kg: DecimalField
  * dosis_total_ml: DecimalField (calculado)
  * ml_por_contenedor: DecimalField
- Cantidades:
  * cantidad_calculada: DecimalField
  * cantidad_manual: DecimalField (override)
  * cantidad_final: DecimalField
- Metadata:
  * calculo_automatico: BooleanField
  * requiere_confirmacion: BooleanField
  * confirmado_por: FK a CustomUser
  * fecha_confirmacion: DateTimeField
  * observaciones: TextField

Method clave:
- calcular_cantidad(): Calcula automÃ¡ticamente cantidad de contenedores
  * Formula: dosis_total_ml = peso_paciente * dosis_ml_por_kg
  * Formula: cantidad = ceil(dosis_total_ml / ml_por_contenedor)
  * Redondeo hacia arriba para no quedar corto

LÃ³gica en save():
- Llama calcular_cantidad() automÃ¡ticamente antes de guardar

Rol funcional real:
âœ“ CÃ¡lculo automÃ¡tico: Determina cuÃ¡ntos contenedores usar
âœ“ Trazabilidad: Guarda cÃ¡lculo completo (peso, dosis, resultado)
âœ“ FacturaciÃ³n: cantidad_final se usa en DetalleVenta
âœ“ ConfirmaciÃ³n: Permite validaciÃ³n manual si faltan datos

Estado: âœ… ACTIVO - Sistema moderno de cÃ¡lculo de insumos


1.10. HospitalizacionInsumo (NUEVO)
------------------------------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 303-376)

DefiniciÃ³n:
Tabla intermedia para insumos de hospitalizaciones.
IdÃ©ntica lÃ³gica a ConsultaInsumo pero para hospitalizaciones.

Campos: Mismos que ConsultaInsumo
Method: calcular_cantidad() con misma lÃ³gica

Rol funcional real:
âœ“ CÃ¡lculo automÃ¡tico para hospitalizaciones
âœ“ FacturaciÃ³n al dar de alta

Estado: âœ… ACTIVO - Sistema de cÃ¡lculo para hospitalizaciones


1.11. CirugiaInsumo (NUEVO)
----------------------------
UbicaciÃ³n: clinica/models.py (lÃ­neas 379-451)

DefiniciÃ³n:
Tabla intermedia para insumos de cirugÃ­as.
IdÃ©ntica lÃ³gica a ConsultaInsumo/HospitalizacionInsumo.

Campos: Mismos que ConsultaInsumo
Method: calcular_cantidad() con misma lÃ³gica

Rol funcional real:
âœ“ CÃ¡lculo automÃ¡tico para cirugÃ­as
âœ“ FacturaciÃ³n dentro de hospitalizaciÃ³n

Estado: âœ… ACTIVO - Sistema de cÃ¡lculo para cirugÃ­as

================================================================================
2. SIGNALS - LÃ“GICA IMPLÃCITA
================================================================================

Archivo: clinica/signals.py

2.1. Signal: crear_cobro_desde_consulta
----------------------------------------
Trigger: post_save de Consulta
CondiciÃ³n: Si NO tiene venta asociada Y tiene servicios o insumos
AcciÃ³n: Llama crear_cobro_pendiente_desde_consulta()

Flujo:
1. Se guarda Consulta
2. Signal verifica si tiene servicios/insumos
3. Crea Venta automÃ¡ticamente en estado 'pendiente'
4. Genera DetalleVenta por cada servicio e insumo

âš  IMPORTANTE: Signal NO se ejecuta en created=True Ãºnicamente
- Se ejecuta cada vez que se GUARDA la consulta
- ProtecciÃ³n: Verifica que no exista venta antes de crearla


2.2. Signal: crear_cobro_desde_hospitalizacion
-----------------------------------------------
Trigger: post_save de Hospitalizacion
CondiciÃ³n: Si estado='alta' Y NO tiene venta Y tiene insumos/cirugÃ­as
AcciÃ³n: Llama crear_cobro_pendiente_desde_hospitalizacion()

Flujo:
1. Se guarda Hospitalizacion con estado='alta'
2. Signal verifica insumos/cirugÃ­as
3. Crea Venta con todos los cargos acumulados
4. Incluye: insumos de hospitalizaciÃ³n + cirugÃ­as + insumos de cirugÃ­a

âš  IMPORTANTE: Solo se ejecuta al cambiar a 'alta'

================================================================================
3. USO REAL EN EL SISTEMA
================================================================================

3.1. DÃ³nde se CREA
------------------

â–¸ Consulta
  - crear_consulta() - POST desde ficha_mascota
  - guardar_consulta() - POST (parece duplicado?)
  - IntegraciÃ³n con agenda: Recibe cita_id opcional

â–¸ Hospitalizacion
  - crear_hospitalizacion() - POST desde ficha_mascota
  - ValidaciÃ³n automÃ¡tica: No permite duplicar hospitalizaciÃ³n activa

â–¸ Cirugia
  - crear_cirugia() - POST, requiere hospitalizacion_id

â–¸ RegistroDiario
  - crear_registro_diario() - POST, requiere hospitalizacion_id

â–¸ Alta
  - crear_alta_medica() - POST, requiere hospitalizacion_id
  - Probablemente cambia estado de hospitalizaciÃ³n a 'alta'

â–¸ Documento
  - subir_documento() - POST multipart/form-data

â–¸ Insumos calculados
  - ConsultaInsumo: Se crea desde crear_consulta()
  - HospitalizacionInsumo: Se crea desde crear_hospitalizacion()
  - CirugiaInsumo: Se crea desde crear_cirugia()
  - CÃ¡lculo automÃ¡tico en save()


3.2. DÃ³nde se EDITA
-------------------

âš  NO hay vistas de ediciÃ³n explÃ­citas detectadas

Posible ediciÃ³n:
- Django Admin (todos los modelos registrados)
- ActualizaciÃ³n de estado de hospitalizaciÃ³n (activa â†’ alta)

Campos auto-actualizados:
- Consulta.fecha (auto_now_add)
- MedicamentoUtilizado.fecha_registro (auto_now_add)
- Documento.fecha_subida (auto_now_add)
- ConsultaInsumo.cantidad_final (calculado en save)


3.3. DÃ³nde se LEE/USA
---------------------

â–¸ Desde clinica:
  - ficha_paciente() / ficha_mascota()
    * Lee consultas para historial
    * Lee citas agendadas
    * Combina en timeline ordenado
  
  - detalle_consulta()
    * Obtiene detalles completos de consulta
    * Incluye medicamentos_detalle

  - obtener_hospitalizaciones()
    * Lista hospitalizaciones del paciente

  - detalle_hospitalizacion()
    * Detalles completos con cirugÃ­as y registros

â–¸ Desde caja:
  - crear_cobro_pendiente_desde_consulta()
    * Lee consulta.servicios para facturar
    * Lee consulta.insumos_detalle para facturar
  
  - crear_cobro_pendiente_desde_hospitalizacion()
    * Lee hospitalizacion.cirugias
    * Lee hospitalizacion.insumos_detalle
    * Lee cirugia.insumos_detalle por cada cirugÃ­a

â–¸ Desde dashboard:
  - dashboard_administracion()
    * Hospitalizaciones activas
    * Registros diarios
  
  - dashboard_veterinario()
    * Hospitalizaciones asignadas
    * Consultas del dÃ­a

â–¸ Desde pacientes:
  - perfil_paciente()
    * Consultas recientes
    * ExÃ¡menes
    * Documentos


3.4. IntegraciÃ³n con otras apps
--------------------------------

â–¸ Con agenda:
  - IntegraciÃ³n MANUAL (no automÃ¡tica)
  - crear_consulta() recibe cita_id opcional
  - Actualiza cita.estado = 'completada' al crear consulta
  - CÃ³digo explÃ­cito en clinica/views.py lÃ­neas 337-345

â–¸ Con caja:
  - IntegraciÃ³n AUTOMÃTICA via signals
  - post_save de Consulta â†’ crea Venta
  - post_save de Hospitalizacion (estado=alta) â†’ crea Venta
  - caja.services lee modelos de clinica para facturar

â–¸ Con inventario:
  - Lee Insumo para medicamentos
  - NO descuenta stock automÃ¡ticamente
  - Relaciones M2M para registrar uso

â–¸ Con pacientes:
  - Todos los modelos clÃ­nicos tienen FK a Paciente
  - CASCADE en la mayorÃ­a: eliminar paciente elimina registros clÃ­nicos

â–¸ Con servicios:
  - Consulta tiene M2M con Servicio
  - Cirugia tiene FK opcional a Servicio
  - Usado para facturaciÃ³n

================================================================================
4. SOLAPAMIENTOS Y DUPLICACIÃ“N
================================================================================

4.1. DuplicaciÃ³n detectada
---------------------------

âš  MedicamentoUtilizado vs ConsultaInsumo

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MedicamentoUtilizado      â”‚ ConsultaInsumo                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Modelo simple             â”‚ Modelo complejo                â”‚
â”‚ Campos bÃ¡sicos            â”‚ CÃ¡lculo automÃ¡tico             â”‚
â”‚ inventario_id (int)       â”‚ insumo (FK PROTECT)            â”‚
â”‚ dosis (string)            â”‚ dosis_ml_por_kg (decimal)      â”‚
â”‚ Sin cÃ¡lculo               â”‚ Con calcular_cantidad()        â”‚
â”‚ LEGACY                    â”‚ MODERNO                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AnÃ¡lisis:
- Ambos cumplen funciÃ³n similar: registrar medicamentos de consulta
- MedicamentoUtilizado es mÃ¡s simple, usado actualmente
- ConsultaInsumo es mÃ¡s sofisticado, preparado para cÃ¡lculo automÃ¡tico
- En crear_consulta() se usa MedicamentoUtilizado
- ConsultaInsumo existe pero parece no usarse aÃºn en vistas

ConclusiÃ³n: TRANSICIÃ“N EN CURSO
- Sistema antiguo: MedicamentoUtilizado (activo)
- Sistema nuevo: ConsultaInsumo (preparado, no implementado completamente)


âš  Relaciones M2M vs Tablas intermedias

Consulta tiene:
- medicamentos = ManyToManyField(Insumo) - RelaciÃ³n simple
- MedicamentoUtilizado - Tabla intermedia con dosis
- ConsultaInsumo - Tabla intermedia moderna

Â¿Por quÃ© 3 formas de lo mismo?
1. medicamentos M2M: RelaciÃ³n bÃ¡sica Django
2. MedicamentoUtilizado: ExtensiÃ³n con dosis (actualmente usado)
3. ConsultaInsumo: VersiÃ³n moderna con cÃ¡lculo automÃ¡tico (futuro)

RecomendaciÃ³n futura: Unificar en ConsultaInsumo Ãºnicamente


4.2. Vistas duplicadas?
------------------------

âš  crear_consulta() vs guardar_consulta()

AnÃ¡lisis de diferencias:
- Ambas crean Consulta
- Ambas guardan medicamentos
- Ambas marcan cita como completada
- crear_consulta() tiene mÃ¡s logging
- guardar_consulta() mÃ¡s simple

Posible causa: Refactor incompleto o mÃºltiples endpoints


4.3. Â¿Legacy o Activo?
----------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Modelo                     â”‚ Estado  â”‚ Evidencia            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Consulta                   â”‚ âœ… ACTIVOâ”‚ Usado diariamente   â”‚
â”‚ MedicamentoUtilizado       â”‚ ğŸŸ  LEGACYâ”‚ Funciona pero simpleâ”‚
â”‚ Hospitalizacion            â”‚ âœ… ACTIVOâ”‚ Flujo completo      â”‚
â”‚ Cirugia                    â”‚ âœ… ACTIVOâ”‚ Parte de hosp       â”‚
â”‚ RegistroDiario             â”‚ âœ… ACTIVOâ”‚ Seguimiento diario  â”‚
â”‚ Alta                       â”‚ âœ… ACTIVOâ”‚ Cierre de hosp      â”‚
â”‚ Examen                     â”‚ ğŸŸ  PASIVOâ”‚ Sin CRUD activo     â”‚
â”‚ Documento                  â”‚ âœ… ACTIVOâ”‚ GestiÃ³n completa    â”‚
â”‚ ConsultaInsumo             â”‚ ğŸŸ¡ PREPARADOâ”‚ Listo, no usado  â”‚
â”‚ HospitalizacionInsumo      â”‚ ğŸŸ¡ PREPARADOâ”‚ Listo, no usado  â”‚
â”‚ CirugiaInsumo              â”‚ ğŸŸ¡ PREPARADOâ”‚ Listo, no usado  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
5. RIESGO Y CLASIFICACIÃ“N
================================================================================

Nivel de criticidad: ğŸ”´ CRÃTICA

5.1. JustificaciÃ³n
------------------

â–¸ Impacto en operaciones
  - ClÃ­nica: Sin estos modelos, NO hay registro mÃ©dico
  - Caja: FacturaciÃ³n depende de signals de clinica
  - Reportes: EstadÃ­sticas dependen de consultas/hospitalizaciones
  - Legal: Registro clÃ­nico obligatorio

â–¸ Dependencias tÃ©cnicas

  Paciente (CASCADE)
     â†“
  Consulta â† Signal â†’ Venta (caja)
     â†“ M2M
  Servicio, Insumo
  
  Paciente (CASCADE)
     â†“
  Hospitalizacion â† Signal â†’ Venta (caja)
     â†“ CASCADE
  Cirugia, RegistroDiario, Alta
     â†“
  Insumos, Servicios

â–¸ Flujo operativo crÃ­tico:
  1. Veterinario inicia consulta desde cita
  2. Crea Consulta con servicios/medicamentos
  3. Signal crea Venta automÃ¡ticamente
  4. Caja cobra al propietario
  5. Dashboard reporta estadÃ­sticas

Eliminar app clinica causarÃ­a:
âœ— PÃ©rdida total del registro mÃ©dico
âœ— Imposibilidad de facturar servicios clÃ­nicos
âœ— PÃ©rdida de trazabilidad mÃ©dica
âœ— Incumplimiento legal (falta historial clÃ­nico)
âœ— Dashboard sin datos operativos

â–¸ ProtecciÃ³n existente:
  âœ“ Signals crean cobros automÃ¡ticamente
  âœ“ ValidaciÃ³n de hospitalizaciÃ³n Ãºnica
  âœ“ FK con PROTECT en insumos (no permite eliminar insumos en uso)
  âš  CASCADE en paciente (eliminar paciente borra todo historial)


5.2. Sensibilidad a cambios
----------------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OperaciÃ³n                      â”‚ Riesgoâ”‚ RazÃ³n                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Agregar campo a Consulta       â”‚ ğŸŸ¢ Bajoâ”‚ Solo migraciÃ³n      â”‚
â”‚ Cambiar signal                 â”‚ ğŸ”´ Altoâ”‚ Afecta facturaciÃ³n  â”‚
â”‚ Eliminar MedicamentoUtilizado  â”‚ ğŸŸ  Medioâ”‚ En uso actualmente  â”‚
â”‚ Activar ConsultaInsumo         â”‚ ğŸŸ  Medioâ”‚ Cambio de flujo     â”‚
â”‚ Modificar calcular_cantidad()  â”‚ ğŸ”´ Altoâ”‚ Afecta facturaciÃ³n  â”‚
â”‚ Eliminar Hospitalizacion       â”‚ ğŸ”´ CRÃTICOâ”‚ Colapsa sistema   â”‚
â”‚ Cambiar CASCADE a SET_NULL     â”‚ ğŸŸ  Medioâ”‚ Cambia borrado      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


5.3. Puntos crÃ­ticos
--------------------

âš  CRÃTICO 1: Signals automÃ¡ticos
  - Signal crea Venta SIN intervenciÃ³n del usuario
  - Si falla signal, consulta queda sin factura
  - No hay mecanismo de recuperaciÃ³n automÃ¡tico
  - Error silencioso (solo print, no alerta)

âš  CRÃTICO 2: ValidaciÃ³n de hospitalizaciÃ³n Ãºnica
  - Solo permite UNA hospitalizaciÃ³n activa por paciente
  - ValidaciÃ³n en clean(), puede saltearse
  - Si falla validaciÃ³n, data inconsistente

âš  CRÃTICO 3: CÃ¡lculo automÃ¡tico de insumos
  - ConsultaInsumo.save() calcula cantidad_final
  - Si fÃ³rmula tiene error, factura incorrecta
  - Redondeo hacia arriba puede sobrefacturar

âš  CRÃTICO 4: IntegraciÃ³n manual con agenda
  - ActualizaciÃ³n de cita.estado es manual
  - Si falla, cita queda en 'en_curso' eternamente
  - No hay rollback si crear_consulta falla despuÃ©s

âš  MEDIO 5: DuplicaciÃ³n MedicamentoUtilizado vs ConsultaInsumo
  - Sistema usa el simple actualmente
  - Sistema complejo existe pero no se usa
  - ConfusiÃ³n en codebase

âš  MEDIO 6: CASCADE en paciente
  - Eliminar paciente borra TODO su historial clÃ­nico
  - No hay soft delete
  - PÃ©rdida irreversible de datos mÃ©dicos

================================================================================
6. CONCLUSIÃ“N Y RECOMENDACIONES
================================================================================

6.1. Veredicto: MANTENER - CRÃTICA
-----------------------------------

Razones:
1. Modelo CENTRAL: Sin clinica, no hay prÃ¡ctica veterinaria
2. IntegraciÃ³n profunda: caja, agenda, dashboard dependen totalmente
3. Registro legal: Historial clÃ­nico obligatorio
4. Signals activos: AutomatizaciÃ³n de facturaciÃ³n
5. Sin alternativa: No hay forma de reemplazar esta funcionalidad

La app clinica es ABSOLUTAMENTE CRÃTICA e IRREMPLAZABLE.


6.2. Calidad tÃ©cnica: ğŸŸ¡ BUENA con Ã¡reas de mejora
---------------------------------------------------

Fortalezas:
âœ“ Modelos bien estructurados
âœ“ Validaciones en clean()
âœ“ Sistema de cÃ¡lculo automÃ¡tico (ConsultaInsumo)
âœ“ Signals para automatizaciÃ³n
âœ“ Relaciones FK/M2M correctas
âœ“ Timestamps automÃ¡ticos
âœ“ Related_name consistentes

Debilidades detectadas:
âš  DuplicaciÃ³n: MedicamentoUtilizado vs ConsultaInsumo
âš  Vistas duplicadas: crear_consulta vs guardar_consulta
âš  Sistema de insumos en transiciÃ³n (antiguo y nuevo coexisten)
âš  Signals sin manejo robusto de errores
âš  IntegraciÃ³n manual con agenda (propensa a errores)
âš  Examen sin CRUD completo
âš  CASCADE en paciente (pÃ©rdida irreversible)
âš  No hay soft delete


6.3. RefactorizaciÃ³n futura (solo anÃ¡lisis)
--------------------------------------------

Si en el futuro se considerara mejorar:

â–¸ Problema 1: DuplicaciÃ³n de sistema de medicamentos
  Estado actual: MedicamentoUtilizado (simple, usado) + ConsultaInsumo (complejo, no usado)
  
  EvaluaciÃ³n futura:
  - Migrar completamente a ConsultaInsumo
  - Eliminar MedicamentoUtilizado
  - MigraciÃ³n de datos histÃ³ricos
  - O mantener MedicamentoUtilizado y eliminar ConsultaInsumo si no se usarÃ¡

â–¸ Problema 2: Vistas duplicadas
  Estado actual: crear_consulta() y guardar_consulta() hacen lo mismo
  
  EvaluaciÃ³n futura:
  - Unificar en una sola vista
  - O documentar claramente por quÃ© existen dos

â–¸ Problema 3: Signals sin manejo robusto de errores
  Estado actual: print() para errores, continÃºa ejecuciÃ³n
  
  EvaluaciÃ³n futura:
  - Implementar logging formal
  - Notificar admin si falla creaciÃ³n de cobro
  - Retry automÃ¡tico o manual
  - O agregar comando de management para regenerar ventas faltantes

â–¸ Problema 4: IntegraciÃ³n manual con agenda
  Estado actual: clinica.views actualiza Cita.estado manualmente
  
  EvaluaciÃ³n futura:
  - Considerar signal en Consulta.post_save para actualizar cita
  - O agregar campo cita FK en Consulta (OneToOneField opcional)
  - O mantener actual si se prefiere control explÃ­cito

â–¸ Problema 5: CASCADE en paciente
  Estado actual: Eliminar paciente borra historial
  
  EvaluaciÃ³n futura:
  - Agregar soft delete (campo 'activo')
  - O cambiar CASCADE a PROTECT en modelos crÃ­ticos
  - O mantener actual si eliminaciÃ³n de paciente es rara

â–¸ Problema 6: Examen sin CRUD
  Estado actual: Modelo existe pero no hay vistas
  
  EvaluaciÃ³n futura:
  - Implementar CRUD completo
  - O eliminar modelo si no se usa
  - O documentar que se gestiona solo desde admin

â–¸ Problema 7: CÃ¡lculo automÃ¡tico en save()
  Estado actual: calcular_cantidad() se ejecuta siempre en save()
  
  EvaluaciÃ³n futura:
  - Validar que no se recalcule si cantidad_manual estÃ¡ seteada
  - Agregar flag 'bloqueado' para evitar recÃ¡lculos accidentales
  - O mantener actual si funciona bien


6.4. DocumentaciÃ³n recomendada
-------------------------------

Para desarrolladores:
- Signals crean Venta automÃ¡ticamente al guardar Consulta/Hospitalizacion
- MedicamentoUtilizado es LEGACY, ConsultaInsumo es MODERNO (no usado aÃºn)
- calcular_cantidad() se ejecuta en save() automÃ¡ticamente
- HospitalizaciÃ³n valida unicidad en clean() - solo una activa por paciente
- IntegraciÃ³n con agenda es MANUAL - actualizar cita.estado explÃ­citamente
- CASCADE en paciente - eliminar paciente borra TODO su historial
- Sistema de insumos en TRANSICIÃ“N - antiguo y nuevo coexisten

Para usuarios:
- Al crear consulta, se genera cobro automÃ¡ticamente
- Al dar de alta hospitalizaciÃ³n, se factura todo junto
- Solo puede haber UNA hospitalizaciÃ³n activa por paciente
- Signos vitales mÃ­nimos: temperatura en consulta
- CÃ¡lculo de medicamentos automÃ¡tico si se usan modelos nuevos

================================================================================
RESUMEN EJECUTIVO
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aspecto           â”‚ EvaluaciÃ³n                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Estado            â”‚ âœ… Activo, crÃ­tico, usado diariamente        â”‚
â”‚ Criticidad        â”‚ ğŸ”´ CRÃTICA - Centro del sistema clÃ­nico      â”‚
â”‚ DuplicaciÃ³n       â”‚ ğŸŸ  Existe duplicaciÃ³n en sistema de insumos  â”‚
â”‚ Calidad tÃ©cnica   â”‚ ğŸŸ¡ Buena, con Ã¡reas de mejora detectadas     â”‚
â”‚ Arquitectura      â”‚ ğŸŸ¢ Bien diseÃ±ada, signals automatizaciÃ³n     â”‚
â”‚ Integraciones     â”‚ ğŸŸ  Manual con agenda, automÃ¡tica con caja    â”‚
â”‚ Riesgo eliminar   â”‚ ğŸ”´ CRÃTICO - Colapsa operaciÃ³n completa      â”‚
â”‚ TransiciÃ³n        â”‚ ğŸŸ¡ Sistema de insumos en migraciÃ³n           â”‚
â”‚ RecomendaciÃ³n     â”‚ MANTENER - ABSOLUTAMENTE CRÃTICA             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Modelos por criticidad:
- Consulta: ğŸ”´ CRÃTICA ABSOLUTA - Centro registro mÃ©dico
- Hospitalizacion: ğŸ”´ CRÃTICA - InternaciÃ³n esencial
- ConsultaInsumo: ğŸŸ¡ PREPARADO - Sistema moderno no implementado
- MedicamentoUtilizado: ğŸŸ  LEGACY ACTIVO - En transiciÃ³n
- Cirugia: ğŸ”´ IMPORTANTE - Parte de hospitalizaciÃ³n
- RegistroDiario: ğŸŸ¢ ACTIVO - Seguimiento
- Alta: ğŸŸ¢ ACTIVO - Cierre
- Documento: ğŸŸ¢ ACTIVO - GestiÃ³n documental
- Examen: ğŸŸ¡ PASIVO - Sin CRUD

Relaciones crÃ­ticas:
- Consulta â†’ Paciente (CASCADE) ğŸ”´
- Consulta â†’ Venta (via signal) ğŸ”´
- Hospitalizacion â†’ Paciente (CASCADE) ğŸ”´
- Hospitalizacion â†’ Venta (via signal) ğŸ”´
- Cirugia â†’ Hospitalizacion (CASCADE) ğŸŸ 
- IntegraciÃ³n con agenda.Cita (manual) ğŸŸ 

AcciÃ³n: NO TOCAR nÃºcleo. App absolutamente fundamental.

Mejoras posibles (futuro):
1. Completar migraciÃ³n a ConsultaInsumo
2. Unificar vistas duplicadas
3. Mejorar manejo de errores en signals
4. Implementar CRUD de Examen o eliminar modelo
5. Considerar soft delete para pacientes

================================================================================
DEPENDENCIAS EXTERNAS (apps que usan clinica)
================================================================================

1. caja (CRÃTICA)
   - Importa: Consulta, Hospitalizacion, ConsultaInsumo, HospitalizacionInsumo
   - FunciÃ³n: FacturaciÃ³n automÃ¡tica via signals
   - Impacto: CRÃTICO - Sin clinica, no hay facturaciÃ³n de servicios mÃ©dicos
   - Tipo: AutomatizaciÃ³n via signals + lectura explÃ­cita

2. signals (AUTOMÃTICA)
   - post_save Consulta â†’ crea Venta
   - post_save Hospitalizacion (estado=alta) â†’ crea Venta
   - Impacto: CRÃTICO - AutomatizaciÃ³n de facturaciÃ³n
   - Tipo: Signal receivers

3. agenda (MANUAL)
   - Referencia: Consulta recibe cita_id
   - FunciÃ³n: Marca cita como completada
   - Impacto: ALTO - IntegraciÃ³n de flujo operativo
   - Tipo: IntegraciÃ³n manual explÃ­cita

4. pacientes (LECTURA)
   - Todas las entidades clÃ­nicas tienen FK a Paciente
   - FunciÃ³n: Historial mÃ©dico del paciente
   - Impacto: CRÃTICO - Sin paciente, no hay registro
   - Tipo: ForeignKey CASCADE

5. dashboard (REPORTES)
   - Importa: Hospitalizacion, RegistroDiario, ConsultaInsumo
   - FunciÃ³n: EstadÃ­sticas operativas
   - Impacto: ALTO - MÃ©tricas de gestiÃ³n
   - Tipo: Solo lectura

6. inventario (REFERENCIA)
   - Usado por: Consulta, Hospitalizacion, Cirugia, RegistroDiario
   - FunciÃ³n: Registrar uso de insumos
   - Impacto: MEDIO - NO descuenta stock automÃ¡ticamente
   - Tipo: ManyToMany + tablas intermedias

7. servicios (REFERENCIA)
   - Usado por: Consulta (M2M), Cirugia (FK)
   - FunciÃ³n: Asociar servicios prestados
   - Impacto: ALTO - Necesario para facturaciÃ³n
   - Tipo: ManyToMany + ForeignKey

8. cuentas (VETERINARIOS)
   - Usado por: Consulta, Hospitalizacion, Cirugia
   - FunciÃ³n: FK a veterinario que atendiÃ³
   - Impacto: CRÃTICO - Trazabilidad de atenciÃ³n
   - Tipo: ForeignKey SET_NULL

================================================================================
FIN DEL ANÃLISIS DIAGNÃ“STICO
================================================================================
