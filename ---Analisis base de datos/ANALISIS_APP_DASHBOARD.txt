â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ANÃLISIS DIAGNÃ“STICO: APP DASHBOARD
  Sistema de Paneles de Control - Veterinaria Santa SofÃ­a
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“… Fecha de anÃ¡lisis: Diciembre 15, 2025
ğŸ¯ PropÃ³sito: DiagnÃ³stico de modelos, uso real y dependencias
âš ï¸  Modalidad: SOLO LECTURA - Sin modificaciones de cÃ³digo

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  1. MODELOS IDENTIFICADOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ IMPORTANTE: La app 'dashboard' NO tiene modelos propios.

Estado de dashboard/models.py:
   â””â”€ Archivo vacÃ­o (solo contiene comentario "# Create your models here.")

ConclusiÃ³n: Dashboard es una app de VISUALIZACIÃ“N pura, no almacena datos.
             Solo CONSUME datos de otras apps mediante queries en las vistas.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  2. USO REAL DEL SISTEMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ARQUITECTURA: DASHBOARD DIFERENCIADO POR ROL                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: dashboard/views.py
URL: /dashboard/
FunciÃ³n principal: dashboard(request) - Vista Ãºnica que bifurca por rol

FLUJO DE RENDERIZADO:
1. Usuario autenticado accede a /dashboard/
2. Vista dashboard() detecta rol del usuario (o parÃ¡metro ?as= para testing)
3. Bifurca a una de 3 funciones auxiliares segÃºn rol:
   â€¢ _datos_administrador(hoy) â†’ template: dashboard/admin.html
   â€¢ _datos_recepcion(hoy, usuario) â†’ template: dashboard/recepcion.html
   â€¢ _datos_veterinario(hoy, usuario) â†’ template: dashboard/veterinario.html
4. Cada funciÃ³n carga datos especÃ­ficos del rol
5. Retorna render con template especÃ­fico

Testing de roles:
   â€¢ /dashboard/?as=admin â†’ Vista de administrador
   â€¢ /dashboard/?as=vet â†’ Vista de veterinario
   â€¢ /dashboard/?as=recepcion â†’ Vista de recepciÃ³n

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FUNCIÃ“N: _datos_administrador(hoy)                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: dashboard/views.py (lÃ­neas 117-252)
Rol: administracion / superuser
Template: dashboard/admin.html

DATOS CARGADOS:

1. AGENDA DEL DÃA (desde agenda.Cita):
   â€¢ citas_hoy: Todas las citas del dÃ­a
   â€¢ citas_stats: Total, pendientes, confirmadas, completadas, canceladas
   â€¢ mis_citas: Solo citas pendientes y confirmadas (para mostrar en widget)

2. HOSPITALIZACIONES ACTIVAS (desde clinica.Hospitalizacion):
   â€¢ hospitalizaciones_activas: Pacientes internados actualmente
   â€¢ Por cada hospitalizaciÃ³n:
     - dias_hospitalizacion: DÃ­as desde ingreso
     - ultimo_registro: Ãšltimo RegistroDiario
     - necesita_actualizacion: True si >12 horas sin registro

3. INVENTARIO (desde inventario.Insumo):
   â€¢ stock_bajo: Insumos con stock_actual <= 10
   â€¢ insumos_utilizados_hoy: Top 5 insumos vendidos hoy (desde DetalleVenta)

4. CAJA (desde caja.SesionCaja, caja.Venta):
   â€¢ sesion_activa: SesionCaja sin cerrar
   â€¢ caja_stats:
     - estado: 'abierta' / 'cerrada'
     - total_vendido_hoy: Suma de ventas de la sesiÃ³n
     - cobros_pendientes: Ventas en estado 'pendiente' (top 10)
     - cobros_pendientes_count: Total de cobros pendientes
     - cobros_pendientes_total: Suma de total de cobros pendientes

5. INDICADORES GENERALES:
   â€¢ citas_hoy, citas_pendientes, citas_completadas
   â€¢ hospitalizados: Total de hospitalizaciones activas
   â€¢ cobros_pendientes_count, cobros_pendientes_total
   â€¢ pacientes_atendidos_hoy: Citas completadas distintas
   â€¢ ingresos_del_dia: Suma de Venta.total pagadas hoy
   â€¢ total_pacientes: Pacientes activos
   â€¢ hospitalizaciones_activas_count

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FUNCIÃ“N: _datos_recepcion(hoy, usuario)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: dashboard/views.py (lÃ­neas 255-327)
Rol: recepcion
Template: dashboard/recepcion.html

DATOS CARGADOS:

1. AGENDA DEL DÃA (desde agenda.Cita):
   â€¢ citas_hoy: Todas las citas del dÃ­a (no filtradas por usuario)
   â€¢ mis_citas: Solo pendientes y confirmadas
   â€¢ agenda_stats: Total, pendientes, confirmadas, completadas

2. HOSPITALIZACIONES (desde clinica.Hospitalizacion):
   â€¢ hospitalizaciones_activas: Todas las activas (no solo del usuario)
   â€¢ mis_hospitalizaciones: Lista completa con cÃ¡lculos de dÃ­as y necesita_actualizacion

3. CAJA (desde caja.SesionCaja, caja.Venta):
   â€¢ sesion_activa: SesionCaja sin cerrar
   â€¢ caja_stats:
     - estado, sesion, puede_abrir
     - total_acumulado: Total vendido en sesiÃ³n activa
     - cobros_pendientes: Top 10 ventas pendientes
     - cobros_pendientes_count

4. INDICADORES:
   â€¢ citas_hoy, citas_pendientes, citas_completadas
   â€¢ hospitalizados, cobros_pendientes_count, cobros_pendientes_total

DIFERENCIA CON ADMIN:
   â€¢ RecepciÃ³n ve TODAS las citas del dÃ­a, no solo las suyas
   â€¢ Puede abrir/cerrar caja (puede_abrir)
   â€¢ No ve inventario detallado

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FUNCIÃ“N: _datos_veterinario(hoy, usuario)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

UbicaciÃ³n: dashboard/views.py (lÃ­neas 330-487)
Rol: veterinario
Template: dashboard/veterinario.html

DATOS CARGADOS:

1. AGENDA PERSONAL (desde agenda.Cita):
   â€¢ citas_del_dia: Solo citas del veterinario actual
   â€¢ mis_citas: Pendientes y confirmadas del dÃ­a
   â€¢ proximas_citas: Primeras 5 citas pendientes/confirmadas
   â€¢ cita_actual: Primera cita en estado 'en_curso'
   â€¢ agenda_stats: Total, completadas, pendientes

2. PACIENTES DEL DÃA:
   â€¢ pacientes_del_dia: Lista con cita y estado de atenciÃ³n

3. HOSPITALIZACIONES ASIGNADAS (desde clinica.Hospitalizacion):
   â€¢ hospitalizaciones_asignadas: Filtradas por veterinario=usuario
   â€¢ Por cada hospitalizaciÃ³n:
     - dias_hospitalizacion
     - ultimo_registro
     - necesita_actualizacion (>12 horas sin registro)

4. ALERTAS CLÃNICAS:
   Sistema de alertas en 3 categorÃ­as:

   a) Cobros pendientes (desde caja.Venta):
      â€¢ Consultas del veterinario con estado='pendiente' de dÃ­as anteriores
      â€¢ Lista completa en alertas_detalladas.cobros_pendientes (top 10)

   b) Insumos sin confirmar (desde clinica.ConsultaInsumo):
      â€¢ ConsultaInsumo con requiere_confirmacion=True y confirmado_por=None
      â€¢ Del veterinario actual
      â€¢ Lista completa en alertas_detalladas.insumos_sin_confirmar (top 10)

   c) Hospitalizaciones sin actualizar:
      â€¢ Hospitalizaciones asignadas con >24 horas sin RegistroDiario
      â€¢ Calcula horas_sin_registro para cada una
      â€¢ Lista en alertas_detalladas.hospitalizaciones_sin_actualizar

5. INDICADORES:
   â€¢ citas_hoy, citas_pendientes, citas_completadas, hospitalizados

6. ALERTAS DETALLADAS:
   â€¢ cobros_pendientes (lista de Venta)
   â€¢ insumos_sin_confirmar (lista de ConsultaInsumo)
   â€¢ hospitalizaciones_sin_actualizar (lista de Hospitalizacion)
   â€¢ total_alertas: Suma de todas las alertas

DIFERENCIA CON OTROS ROLES:
   â€¢ Solo ve SUS citas y SUS hospitalizaciones
   â€¢ Sistema completo de alertas clÃ­nicas
   â€¢ No ve estado de caja

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEMPLATES Y PARTIALS                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ESTRUCTURA DE TEMPLATES:
dashboard/templates/
   â”œâ”€â”€ dashboard/
   â”‚   â”œâ”€â”€ admin.html           â†’ Dashboard de administrador
   â”‚   â”œâ”€â”€ recepcion.html       â†’ Dashboard de recepciÃ³n
   â”‚   â””â”€â”€ veterinario.html     â†’ Dashboard de veterinario
   â”œâ”€â”€ dashboard.html           â†’ Fallback genÃ©rico (con botones de testing)
   â”œâ”€â”€ partials/
   â”‚   â””â”€â”€ dashboard/
   â”‚       â”œâ”€â”€ agenda.html           â†’ Widget de agenda (usa mis_citas)
   â”‚       â”œâ”€â”€ hospitalizaciones.html â†’ Widget de hospitalizaciones
   â”‚       â”œâ”€â”€ caja.html             â†’ Widget de estado de caja
   â”‚       â”œâ”€â”€ pacientes.html        â†’ Widget de pacientes
   â”‚       â””â”€â”€ acciones.html         â†’ Widget de acciones rÃ¡pidas
   â””â”€â”€ kaiadmin/                â†’ Templates de demostraciÃ³n (UI kit)
       â”œâ”€â”€ components/
       â”œâ”€â”€ forms/
       â”œâ”€â”€ tables/
       â”œâ”€â”€ charts/
       â”œâ”€â”€ maps/
       â””â”€â”€ widgets.html

PARTIALS REUTILIZABLES:
Los partials en dashboard/templates/partials/dashboard/ son componentes
que se incluyen en los 3 dashboards principales usando {% include %}.

Ejemplo:
   â€¢ agenda.html espera contexto "mis_citas"
   â€¢ hospitalizaciones.html espera "mis_hospitalizaciones"
   â€¢ caja.html espera "caja_stats"

Este diseÃ±o permite que los 3 roles compartan el mismo HTML pero con
datos filtrados segÃºn el rol.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VISTAS DEMO DE KAIADMIN (NO USADAS)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

dashboard/views.py contiene mÃºltiples funciones para demostrar componentes
del template Kaiadmin (bootstrap admin theme):

â€¢ avatars(), buttons(), gridsystem(), panels(), notifications(), typography()
â€¢ font_awesome_icons(), simple_line_icons(), sweetalert()
â€¢ forms(), tables(), datatables()
â€¢ charts(), sparkline()
â€¢ googlemaps(), jsvectormap()
â€¢ widgets()
â€¢ icon_menu(), sidebar_style_2()

Estado: DEMO / DOCUMENTACIÃ“N - No se usan en el sistema real
UbicaciÃ³n: dashboard/views.py (lÃ­neas 68-115, 489-506)

Estas vistas renderizan templates en dashboard/templates/kaiadmin/ que
muestran ejemplos de componentes UI del theme.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  3. DEPENDENCIAS CON OTRAS APPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IMPORTS DIRECTOS (Dashboard consume estas apps)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

dashboard â†’ agenda (CRÃTICO):
   â€¢ Import: from agenda.models import Cita
   â€¢ Uso: Cargar citas del dÃ­a, stats de agenda, mis_citas
   â€¢ En todas las vistas: _datos_administrador, _datos_recepcion, _datos_veterinario
   â€¢ Datos: fecha, hora_inicio, estado, veterinario, paciente, servicio

dashboard â†’ pacientes (CRÃTICO):
   â€¢ Import: from pacientes.models import Paciente
   â€¢ Uso: Total de pacientes activos, datos de propietario (via FK)
   â€¢ Acceso: Siempre a travÃ©s de Cita.paciente o Hospitalizacion.paciente

dashboard â†’ clinica (CRÃTICO):
   â€¢ Import: from clinica.models import Hospitalizacion, RegistroDiario, ConsultaInsumo
   â€¢ Uso:
     - Hospitalizacion: Pacientes internados, estado='activa', filtro por veterinario
     - RegistroDiario: Calcular Ãºltimo registro, necesita_actualizacion
     - ConsultaInsumo: Alertas de insumos sin confirmar (veterinario)
   â€¢ En: _datos_administrador, _datos_recepcion, _datos_veterinario

dashboard â†’ caja (CRÃTICO):
   â€¢ Import: from caja.models import SesionCaja, Venta, DetalleVenta
   â€¢ Uso:
     - SesionCaja: Estado de caja (abierta/cerrada), total vendido
     - Venta: Cobros pendientes, ingresos del dÃ­a
     - DetalleVenta: Insumos mÃ¡s utilizados del dÃ­a
   â€¢ En: _datos_administrador, _datos_recepcion, _datos_veterinario

dashboard â†’ inventario (MEDIO):
   â€¢ Import: from inventario.models import Insumo
   â€¢ Uso: Stock bajo (stock_actual <= 10)
   â€¢ Solo en: _datos_administrador
   â€¢ No usado por recepciÃ³n ni veterinario

dashboard â†’ servicios (NO USADO):
   â€¢ No hay import directo de servicios.models
   â€¢ Acceso a servicios solo via Cita.servicio (FK)

dashboard â†’ cuentas (IMPLÃCITO):
   â€¢ No hay import directo
   â€¢ Acceso a usuarios via request.user y FKs como Cita.veterinario

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEPENDENCIAS INVERSAS (Otras apps usan dashboard)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

login â†’ dashboard:
   â€¢ login/views.py: redirect('dashboard:dashboard') despuÃ©s de login
   â€¢ settings.py: LOGIN_REDIRECT_URL = '/dashboard/'
   â€¢ Uso: RedirecciÃ³n principal despuÃ©s de autenticaciÃ³n

caja â†’ dashboard:
   â€¢ caja/views.py: redirect('dashboard:dashboard') en varias vistas
   â€¢ Uso: RedirecciÃ³n cuando usuario no tiene permisos

templates â†’ dashboard:
   â€¢ templates/partials/sidebar.html: Link al dashboard en logo y menÃº
   â€¢ templates/partials/topbar.html: Link al dashboard en logo
   â€¢ Uso: NavegaciÃ³n principal

TODAS las apps:
   â€¢ Dashboard es el HUB central despuÃ©s de login
   â€¢ Todas las operaciones eventualmente retornan al dashboard

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ANÃLISIS DE QUERIES: OPTIMIZACIÃ“N                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Las funciones _datos_* usan select_related() para optimizar queries:

âœ… OPTIMIZADO:
   â€¢ Cita.objects.filter(...).select_related('paciente__propietario', 'veterinario', 'servicio')
   â€¢ Hospitalizacion.objects.filter(...).select_related('paciente__propietario', 'veterinario')
   â€¢ Venta.objects.filter(...).select_related('paciente')

Beneficio: Evita N+1 queries al acceder a FKs en templates

âš ï¸ POTENCIAL MEJORA:
   â€¢ RegistroDiario.objects.filter(...).order_by('-fecha_registro').first()
     Se ejecuta dentro de un loop â†’ PodrÃ­a usar prefetch_related

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  4. SOLAPAMIENTOS Y FUNCIONALIDAD DUPLICADA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NO HAY DUPLICACIÃ“N DE MODELOS                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Dashboard NO tiene modelos propios, por lo tanto no hay solapamiento con
otras apps en tÃ©rminos de almacenamiento de datos.

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CÃ“DIGO REPETIDO: LÃ“GICA COMPARTIDA ENTRE ROLES                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸŸ¡ REPETICIÃ“N DETECTADA:

CÃ¡lculo de "dias_hospitalizacion" y "necesita_actualizacion":
   â€¢ UbicaciÃ³n: 3 lugares
     - _datos_administrador (lÃ­neas 154-170)
     - _datos_recepcion (lÃ­neas 294-311)
     - _datos_veterinario (lÃ­neas 384-398)
   
   â€¢ LÃ³gica idÃ©ntica:
     ```
     for hosp in hospitalizaciones:
         hosp.dias_hospitalizacion = (hoy - fecha_ingreso).days
         hosp.ultimo_registro = RegistroDiario.objects.filter(...).first()
         if hosp.ultimo_registro:
             horas_desde_registro = (timezone.now() - hosp.ultimo_registro.fecha_registro).total_seconds() / 3600
             hosp.necesita_actualizacion = horas_desde_registro >= 12
         else:
             hosp.necesita_actualizacion = True
     ```
   
   â€¢ Impacto: MEDIO - Funciona pero no DRY
   â€¢ Mejora posible: Extraer a funciÃ³n auxiliar o mÃ©todo de modelo

ObtenciÃ³n de cobros pendientes:
   â€¢ UbicaciÃ³n: 3 lugares
     - _datos_administrador (lÃ­nea 186)
     - _datos_recepcion (lÃ­nea 303)
     - _datos_veterinario (lÃ­nea 447)
   
   â€¢ LÃ³gica similar pero con filtros diferentes:
     - Admin: Venta.objects.filter(estado='pendiente')
     - RecepciÃ³n: Igual que admin
     - Veterinario: Venta.objects.filter(tipo_origen='consulta', consulta__veterinario=usuario, estado='pendiente')
   
   â€¢ Impacto: BAJO - Filtros son diferentes por rol

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VISTAS DEMO DE KAIADMIN: NO USADAS                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Estado: DOCUMENTACIÃ“N / DEMO del theme bootstrap
UbicaciÃ³n: dashboard/views.py + dashboard/templates/kaiadmin/

Vistas demo (14 funciones):
   â€¢ avatars, buttons, gridsystem, panels, notifications, typography
   â€¢ font_awesome_icons, simple_line_icons, sweetalert
   â€¢ forms, tables, datatables
   â€¢ charts, sparkline, googlemaps, jsvectormap, widgets
   â€¢ icon_menu, sidebar_style_2

Uso real: NO se usan en operaciÃ³n normal de la veterinaria
PropÃ³sito: Referencia de componentes UI disponibles en el theme

Riesgo de eliminaciÃ³n: BAJO - Son solo ejemplos
Beneficio de mantener: DocumentaciÃ³n visual del theme

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  5. CLASIFICACIÃ“N DE RIESGO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ APP CRÃTICA - ABSOLUTAMENTE ESENCIAL                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ClasificaciÃ³n: ğŸ”´ CRÃTICA - MÃXIMA PRIORIDAD

Motivos:

1. HUB CENTRAL DE NAVEGACIÃ“N:
   â€¢ Primera vista despuÃ©s de login (LOGIN_REDIRECT_URL)
   â€¢ Todas las apps redirigen aquÃ­ en caso de error o falta de permisos
   â€¢ Punto de entrada principal para todos los roles
   
2. INTEGRACIÃ“N TOTAL:
   â€¢ Consume datos de 5 apps crÃ­ticas: agenda, clinica, caja, pacientes, inventario
   â€¢ Ãšnico punto donde se consolida informaciÃ³n de mÃºltiples fuentes
   â€¢ Vista unificada del estado del negocio
   
3. DIFERENCIACIÃ“N POR ROL:
   â€¢ Administrador: Vista completa (caja, inventario, todas las citas)
   â€¢ RecepciÃ³n: Enfoque en agenda y caja
   â€¢ Veterinario: Agenda personal, hospitalizaciones, alertas clÃ­nicas
   
4. SISTEMA DE ALERTAS:
   â€¢ Ãšnico lugar donde veterinarios ven:
     - Cobros pendientes de sus consultas
     - Insumos sin confirmar
     - Hospitalizaciones sin actualizar
   
5. MONITOREO OPERATIVO:
   â€¢ Estado de caja en tiempo real
   â€¢ Hospitalizaciones activas y tiempo sin registro
   â€¢ Stock bajo (administrador)
   â€¢ Pacientes del dÃ­a
   
6. MÃ‰TRICAS DE NEGOCIO:
   â€¢ Ingresos del dÃ­a
   â€¢ Pacientes atendidos
   â€¢ Citas completadas
   â€¢ Cobros pendientes (monto total)

Riesgo de eliminaciÃ³n: IMPOSIBLE
   â€¢ Sin dashboard, el sistema pierde su punto de entrada principal
   â€¢ Usuarios no tendrÃ­an forma de ver su trabajo pendiente
   â€¢ PÃ©rdida de visibilidad del estado del negocio
   â€¢ Colapso de UX (sin navegaciÃ³n central)

Riesgo de modificaciÃ³n: ALTO
   â€¢ Cambios en dashboard afectan experiencia de TODOS los usuarios
   â€¢ Errores en queries pueden sobrecargar la base de datos
   â€¢ Modificar estructura de contexto rompe templates

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  6. CONCLUSIÃ“N FINAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESTADO ACTUAL:
--------------
La app 'dashboard' es el CENTRO DE CONTROL del sistema VetSantaSofia.
Es la primera vista que ven todos los usuarios despuÃ©s de hacer login y
el punto de retorno principal en toda la navegaciÃ³n.

ARQUITECTURA:
------------
â€¢ TIPO: App de visualizaciÃ³n pura (sin modelos)
â€¢ PATRÃ“N: Vista Ãºnica que bifurca por rol
â€¢ ROLES: AdministraciÃ³n, RecepciÃ³n, Veterinario
â€¢ TESTING: Permite simular roles con parÃ¡metro ?as=

FUNCIÃ“N PRINCIPAL:
-----------------
Consolidar informaciÃ³n de mÃºltiples apps en una vista unificada segÃºn el rol:

1. ADMINISTRADOR:
   â€¢ Vista completa del negocio
   â€¢ Citas, hospitalizaciones, inventario, caja
   â€¢ MÃ©tricas de ingresos y pacientes

2. RECEPCIÃ“N:
   â€¢ Enfoque en agenda y caja
   â€¢ Todas las citas del dÃ­a (no filtradas)
   â€¢ Estado de caja y cobros pendientes

3. VETERINARIO:
   â€¢ Agenda personal
   â€¢ Hospitalizaciones asignadas
   â€¢ Sistema de alertas clÃ­nicas (cobros, insumos, registros)

DEPENDENCIAS CRÃTICAS:
---------------------
dashboard CONSUME (no puede vivir sin):
   â€¢ agenda.Cita â†’ Agenda del dÃ­a
   â€¢ clinica.Hospitalizacion, RegistroDiario, ConsultaInsumo â†’ Estado clÃ­nico
   â€¢ caja.SesionCaja, Venta, DetalleVenta â†’ Estado financiero
   â€¢ pacientes.Paciente â†’ InformaciÃ³n de pacientes
   â€¢ inventario.Insumo â†’ Control de stock (solo admin)

Otras apps USAN dashboard:
   â€¢ login â†’ RedirecciÃ³n principal despuÃ©s de autenticaciÃ³n
   â€¢ caja â†’ RedirecciÃ³n cuando falta permisos
   â€¢ templates â†’ NavegaciÃ³n (sidebar, topbar)

ASPECTOS TÃ‰CNICOS:
-----------------
âœ… Optimizado:
   â€¢ Usa select_related() para evitar N+1 queries
   â€¢ Partials reutilizables para componentes comunes

âš ï¸ CÃ³digo repetido:
   â€¢ CÃ¡lculo de dias_hospitalizacion en 3 lugares
   â€¢ LÃ³gica de necesita_actualizacion duplicada
   â€¢ Mejora: Extraer a funciÃ³n auxiliar

ğŸŸ¡ Vistas demo:
   â€¢ 14+ vistas de demostraciÃ³n del theme Kaiadmin
   â€¢ Estado: NO USADAS en operaciÃ³n
   â€¢ Riesgo de eliminar: BAJO - Son solo ejemplos

CLASIFICACIÃ“N DE RIESGO:
-----------------------
ğŸ”´ CRÃTICA - MÃXIMA PRIORIDAD

La app dashboard es ABSOLUTAMENTE ESENCIAL:
   â€¢ Punto de entrada principal del sistema
   â€¢ Ãšnico consolidador de informaciÃ³n multi-app
   â€¢ Sistema de alertas para veterinarios
   â€¢ Vista unificada del estado del negocio

Eliminar dashboard = COLAPSO DEL SISTEMA
Modificar dashboard = Riesgo alto de afectar a todos los usuarios

RECOMENDACIÃ“N OPERATIVA:
-----------------------
1. MANTENER: Dashboard es esencial, no eliminar
2. OPTIMIZAR: Extraer lÃ³gica repetida a funciones auxiliares
3. CONSIDERAR: Eliminar vistas demo de Kaiadmin si no se usan
4. MONITOREAR: Performance de queries en loop (RegistroDiario)

Prioridad: ğŸ”´ MÃXIMA
La app 'dashboard' es el corazÃ³n de la experiencia del usuario. Cualquier
problema en esta app afecta a TODOS los roles en su primer punto de contacto
con el sistema.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  FIN DEL ANÃLISIS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
