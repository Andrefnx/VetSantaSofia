{% extends 'partials/dashboard_base.html' %}
{% load static %}

{% block dashboard_title %}Dashboard Administrador{% endblock %}

{% block dashboard_extra_css %}
<link rel="stylesheet" href="{% static 'css/base/tables_base.css' %}">
<link rel="stylesheet" href="{% static 'css/custom/dashboard_vet.css' %}">
{% endblock %}

{% block dashboard_inline_styles %}
<style>
    .action-link {
        color: #6b7280;
        font-size: 0.85rem;
        text-decoration: none;
        transition: color 0.2s ease-in-out;
    }
    .action-link:hover {
        color: #111827;
    }
</style>
{% endblock %}

{% block dashboard_page_header %}
<div class="page-header">
    <h3 class="fw-bold mb-3">Dashboard Administrador</h3>
</div>
{% endblock %}

{% block dashboard_metrics %}
<!-- Indicadores Principales -->
<div class="row g-2 mb-3">
    <div class="col-6 col-md">
        <div class="card card-stats card-round">
            <div class="card-body p-3">
                <div class="row align-items-center">
                    <div class="col-icon">
                        <div class="icon-big text-center icon-primary bubble-shadow-small">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="col col-stats ms-2">
                        <div class="numbers">
                            <p class="card-category">Citas Hoy</p>
                            <h4 class="card-title">{{ indicadores.citas_hoy }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md">
        <div class="card card-stats card-round">
            <div class="card-body p-3">
                <div class="row align-items-center">
                    <div class="col-icon">
                        <div class="icon-big text-center icon-warning bubble-shadow-small">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="col col-stats ms-2">
                        <div class="numbers">
                            <p class="card-category">Pendientes</p>
                            <h4 class="card-title">{{ indicadores.citas_pendientes }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md">
        <div class="card card-stats card-round">
            <div class="card-body p-3">
                <div class="row align-items-center">
                    <div class="col-icon">
                        <div class="icon-big text-center icon-success bubble-shadow-small">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="col col-stats ms-2">
                        <div class="numbers">
                            <p class="card-category">Completadas</p>
                            <h4 class="card-title">{{ indicadores.citas_completadas }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md">
        <div class="card card-stats card-round">
            <div class="card-body p-3">
                <div class="row align-items-center">
                    <div class="col-icon">
                        <div class="icon-big text-center icon-info bubble-shadow-small">
                            <i class="fas fa-hospital"></i>
                        </div>
                    </div>
                    <div class="col col-stats ms-2">
                        <div class="numbers">
                            <p class="card-category">Hospitalizados</p>
                            <h4 class="card-title">{{ indicadores.hospitalizados }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-6 col-md">
        <div class="card card-stats card-round">
            <div class="card-body p-3">
                <div class="row align-items-center">
                    <div class="col-icon">
                        <div class="icon-big text-center icon-danger bubble-shadow-small">
                            <i class="fas fa-credit-card"></i>
                        </div>
                    </div>
                    <div class="col col-stats ms-2">
                        <div class="numbers">
                            <p class="card-category">Pagos Pendientes</p>
                            <h4 class="card-title">{{ indicadores.cobros_pendientes_count }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block dashboard_main %}
<!-- ADMIN LAYOUT -->
<div class="row mb-3">
    <div class="col-md-8 d-flex flex-column gap-3">
        {% include 'partials/dashboard/agenda.html' %}
        {% include 'partials/dashboard/pacientes.html' %}
    </div>
    <div class="col-md-4 d-flex flex-column gap-3">
        {% include 'partials/dashboard/acciones.html' %}
        {% include 'partials/dashboard/caja.html' %}

        <!-- HOSPITALIZACIONES DESACTUALIZADAS -->
        {% if mis_hospitalizaciones %}
            {% for hosp in mis_hospitalizaciones %}
                {% if hosp.necesita_actualizacion %}
        <div class="card card-round border-danger">
            <div class="card-body bg-danger-subtle">
                <h5 class="mb-3">
                    <i class="fas fa-exclamation-circle me-2" style="color: #dc3545;"></i>
                    Hospitalización Desactualizada
                </h5>
                <div class="mb-2">
                    <h6 class="mb-2 d-flex align-items-center gap-2" style="font-weight:600;">
                        <i class="fas fa-paw"></i>
                        {{ hosp.paciente.nombre }}
                    </h6>
                    <small class="d-block text-muted">
                        <strong>Propietario:</strong> {{ hosp.paciente.propietario.nombre_completo }}
                    </small>
                    <small class="d-block text-muted">
                        <strong>Veterinario:</strong> {{ hosp.veterinario.nombre|default:"" }}
                    </small>
                    <small class="d-block text-muted">
                        <strong>Ingreso:</strong> {{ hosp.fecha_ingreso|date:"d/m/Y H:i" }}
                    </small>
                    <small class="d-block text-muted">
                        <strong>Días:</strong> {{ hosp.dias_hospitalizacion }} días
                    </small>
                    {% if hosp.ultimo_registro %}
                    <small class="d-block text-muted">
                        <strong>Última actualización:</strong> <span style="color: #dc3545;">{{ hosp.ultimo_registro.fecha_registro|timesince }} ago</span>
                    </small>
                    {% else %}
                    <small class="d-block text-muted">
                        <strong>Última actualización:</strong> <span style="color: #dc3545;">Sin registros</span>
                    </small>
                    {% endif %}
                </div>
                <a href="{% url 'pacientes:ficha_mascota' hosp.paciente.id %}?tab=hospital&hosp_id={{ hosp.id }}#hospital" class="btn btn-sm btn-danger w-100">
                    <i class="fas fa-sync-alt me-1"></i>
                    Actualizar Ahora
                </a>
            </div>
        </div>
                {% endif %}
            {% endfor %}
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="module">
import { initManageWheel } from '{% static "js/base/wheel_base.js" %}';
initManageWheel();

// Recargar página cada 5 minutos para actualizar información
setTimeout(() => location.reload(), 300000);
</script>
{% endblock %}
