{% extends 'partials/dashboard_base.html' %}
{% load static %}

{% block dashboard_title %}Dashboard Veterinario{% endblock %}

{% block dashboard_extra_css %}
<link rel="stylesheet" href="{% static 'css/base/tables_base.css' %}">
<link rel="stylesheet" href="{% static 'css/custom/dashboard_vet.css' %}">
{% endblock %}

{% block dashboard_page_header %}
<div class="page-header">
    <h3 class="fw-bold mb-3">Mi Dashboard</h3>
</div>
{% endblock %}

{% block dashboard_metrics %}

<!-- Indicadores -->
<div class="row">
    <div class="col-sm-6 col-md-3">
        <div class="card card-stats card-round">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-icon">
                        <div class="icon-big text-center icon-primary bubble-shadow-small">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                        <div class="numbers">
                            <p class="card-category">Citas Hoy</p>
                            <h4 class="card-title">{{ indicadores.citas_hoy }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="card card-stats card-round">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-icon">
                        <div class="icon-big text-center icon-warning bubble-shadow-small">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                        <div class="numbers">
                            <p class="card-category">Pendientes</p>
                            <h4 class="card-title">{{ indicadores.citas_pendientes }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="card card-stats card-round">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-icon">
                        <div class="icon-big text-center icon-success bubble-shadow-small">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                        <div class="numbers">
                            <p class="card-category">Completadas</p>
                            <h4 class="card-title">{{ indicadores.citas_completadas }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-6 col-md-3">
        <div class="card card-stats card-round">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-icon">
                        <div class="icon-big text-center icon-info bubble-shadow-small">
                            <i class="fas fa-hospital"></i>
                        </div>
                    </div>
                    <div class="col col-stats ms-3 ms-sm-0">
                        <div class="numbers">
                            <p class="card-category">Hospitalizados</p>
                            <h4 class="card-title">{{ indicadores.hospitalizados }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block dashboard_main %}
<!-- VETERINARIO LAYOUT -->
<div class="row mb-3">
    <div class="col-md-8 d-flex flex-column gap-3">
        {% if cita_actual %}
        <div class="card card-round mb-0 border-warning">
            <div class="card-body bg-warning-subtle">
                <h5 class="mb-3">
                    <i class="fas fa-stethoscope me-2"></i>
                    Consulta en Curso
                </h5>
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h4 class="mb-2">
                            <i class="fas fa-paw me-2"></i>
                            {{ cita_actual.paciente.nombre }}
                        </h4>
                        <p class="mb-1">
                            <strong>Propietario:</strong> {{ cita_actual.paciente.propietario.nombre_completo }}<br>
                            <strong>Tipo:</strong> {{ cita_actual.get_tipo_display }}<br>
                            <strong>Hora Inicio:</strong> {{ cita_actual.hora_inicio|time:"H:i" }}
                        </p>
                    </div>
                    <div class="col-md-4 text-end">
                        <a href="/pacientes/{{ cita_actual.paciente.id }}/?tab=historial&start_cita={{ cita_actual.id }}#historial" class="btn btn-warning btn-lg">
                            <i class="fas fa-notes-medical me-2"></i>
                            Continuar Consulta
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% include 'partials/dashboard/agenda.html' %}
        {% include 'partials/dashboard/pacientes.html' %}
    </div>
    <div class="col-md-4 d-flex flex-column gap-3">
        {% include 'partials/dashboard/acciones.html' %}

        {% if proxima_cita %}
        <div class="card card-round border-info">
            <div class="card-body bg-info-subtle">
                <h5 class="mb-3">
                    <i class="fas a-clock me-2"></i>
                    Próxima Cita
                </h5>
                <div class="row align-items-center">
                    <div class="col-8">
                        <h6 class="mb-2 d-flex align-items-center gap-2" style="font-weight:600;">
                            <i class="fas fa-paw"></i>
                            {{ proxima_cita.paciente.nombre }}
                        </h6>
                        <small class="d-block text-muted vd-meta">
                            <strong>Propietario:</strong> {{ proxima_cita.paciente.propietario.nombre_completo }}
                        </small>
                        <small class="d-block text-muted vd-meta">
                            <strong>Tipo:</strong> {{ proxima_cita.get_tipo_display }}
                        </small>
                        <small class="d-block text-muted vd-meta">
                            <strong>Hora:</strong> {{ proxima_cita.hora_inicio|time:"H:i" }}
                        </small>
                    </div>
                    <div class="col-4 text-end vd-cta-column">
                        <a href="/agenda/?detalle_cita={{ proxima_cita.id }}" class="btn btn-sm btn-info mb-2">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="/pacientes/{{ proxima_cita.paciente.id }}/?tab=historial&start_cita={{ proxima_cita.id }}#historial" class="btn btn-sm btn-info">
                            <i class="fas fa-play"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="module">
import { initManageWheel } from '{% static "js/base/wheel_base.js" %}';
initManageWheel();

// Recargar página cada 5 minutos para actualizar citas
setTimeout(() => location.reload(), 300000);
</script>
{% endblock %}
