{% extends 'partials/base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="d-flex align-items-left align-items-md-center flex-column flex-md-row pt-2 pb-4">
    <div>
        <h3 class="fw-bold mb-3">Panel General</h3>
        <h6 class="op-7 mb-2">Bienvenido, {{ user.nombre }} {{ user.apellido }}</h6>
    </div>
</div>

<!-- Quick Actions Section -->
<div class="row mb-4">
    <div class="col-12">
        <h4 class="fw-bold mb-3">‚ö° Acciones R√°pidas</h4>
    </div>
    <div class="col-md-2">
        <a href="#" class="text-decoration-none">
            <div class="quick-action-card action-cita">
                <div class="icon">
                    <i class="fas fa-calendar-plus"></i>
                </div>
                <h6>Nueva Cita</h6>
                <p>Agendar</p>
            </div>
        </a>
    </div>
    <div class="col-md-2">
        <a href="#" class="text-decoration-none">
            <div class="quick-action-card action-mascota">
                <div class="icon">
                    <i class="fas fa-paw"></i>
                </div>
                <h6>Nueva Mascota</h6>
                <p>Registrar</p>
            </div>
        </a>
    </div>
    <div class="col-md-2">
        <a href="#" class="text-decoration-none">
            <div class="quick-action-card action-consulta">
                <div class="icon">
                    <i class="fas fa-notes-medical"></i>
                </div>
                <h6>Consulta</h6>
                <p>Iniciar</p>
            </div>
        </a>
    </div>
    <div class="col-md-2">
        <a href="#" class="text-decoration-none">
            <div class="quick-action-card action-venta">
                <div class="icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h6>Venta R√°pida</h6>
                <p>Realizar</p>
            </div>
        </a>
    </div>
    <div class="col-md-2">
        <a href="{% url 'caja:cashregister' %}" class="text-decoration-none">
            <div class="quick-action-card action-caja">
                <div class="icon">
                    <i class="fas fa-cash-register"></i>
                </div>
                <h6>Ir a Caja</h6>
                <p>Punto de venta</p>
            </div>
        </a>
    </div>
    <div class="col-md-2">
        <a href="#" class="text-decoration-none">
            <div class="quick-action-card action-reporte">
                <div class="icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h6>Reportes</h6>
                <p>Ver estad√≠sticas</p>
            </div>
        </a>
    </div>
</div>

<!-- Estad√≠sticas de Caja -->
<div class="row mb-4">
    <div class="col-12">
        <h4 class="fw-bold mb-3">üí∞ Estado de Caja</h4>
    </div>
    
    <!-- Cash Status Card -->
    <div class="col-md-3">
        <div class="card card-round">
            <div class="card-body">
                <h6>
                    <i class="fas fa-cash-register"></i> Caja Abierta
                </h6>
                <div class="h2">
                    $1,245,500
                </div>
                <div class="row">
                    <div class="col-6">
                        <strong>Cajero:</strong><br>{{ user.nombre }}
                    </div>
                    <div class="col-6">
                        <strong>Inicio:</strong><br>09:00 AM
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ingresos -->
    <div class="col-md-3">
        <div class="card card-round">
            <div class="card-body">
                <div class="d-flex align-items-center mb-2">
                    <div>
                        <i class="fas fa-arrow-down"></i>
                    </div>
                    <div class="ms-2">
                        <h6 class="text-muted">Ingresos</h6>
                        <div class="h4 text-success">$1,195K</div>
                    </div>
                </div>
                <small class="text-muted">
                    <i class="fas fa-shopping-cart"></i> 18 ventas
                </small>
            </div>
        </div>
    </div>

    <!-- Egresos -->
    <div class="col-md-3">
        <div class="card card-round">
            <div class="card-body">
                <div class="d-flex align-items-center mb-2">
                    <div>
                        <i class="fas fa-arrow-up"></i>
                    </div>
                    <div class="ms-2">
                        <h6 class="text-muted">Egresos</h6>
                        <div class="h4 text-danger">$85K</div>
                    </div>
                </div>
                <small class="text-muted">
                    <i class="fas fa-file-invoice"></i> 5 gastos
                </small>
            </div>
        </div>
    </div>

    <!-- Balance -->
    <div class="col-md-3">
        <div class="card card-round">
            <div class="card-body">
                <div class="d-flex align-items-center mb-2">
                    <div>
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="ms-2">
                        <h6 class="text-muted">Balance</h6>
                        <div class="h4 text-success">$1,110K</div>
                    </div>
                </div>
                <small class="text-muted">
                    <i class="fas fa-exchange-alt"></i> 23 movimientos
                </small>
            </div>
        </div>
    </div>
</div>

<!-- √öltimas Transacciones de Caja -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card card-round">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold mb-0">
                        <i class="fas fa-receipt"></i> √öltimas Transacciones
                    </h5>
                    <a href="{% url 'caja:cashregister' %}" class="btn btn-sm btn-primary">
                        <i class="fas fa-arrow-right"></i> Ver todas
                    </a>
                </div>

                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Hora</th>
                                <th>Descripci√≥n</th>
                                <th>Cliente</th>
                                <th>M√©todo</th>
                                <th class="text-end">Monto</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>15:45</td>
                                <td><i class="fas fa-stethoscope text-primary"></i> Consulta + Vacuna</td>
                                <td>Mar√≠a Gonz√°lez</td>
                                <td><span class="badge bg-success">Efectivo</span></td>
                                <td class="text-end" style="color: #16a34a; font-weight: 600;">+$45,000</td>
                            </tr>
                            <tr>
                                <td>14:30</td>
                                <td><i class="fas fa-pills text-info"></i> Revolution Plus</td>
                                <td>Carlos P√©rez</td>
                                <td><span class="badge bg-info">D√©bito</span></td>
                                <td class="text-end" style="color: #16a34a; font-weight: 600;">+$32,500</td>
                            </tr>
                            <tr>
                                <td>12:00</td>
                                <td><i class="fas fa-boxes text-warning"></i> Insumos m√©dicos</td>
                                <td>Proveedor XYZ</td>
                                <td><span class="badge bg-warning">Transferencia</span></td>
                                <td class="text-end" style="color: #dc2626; font-weight: 600;">-$85,000</td>
                            </tr>
                            <tr>
                                <td>11:15</td>
                                <td><i class="fas fa-cut text-danger"></i> Cirug√≠a</td>
                                <td>Sof√≠a Ram√≠rez</td>
                                <td><span class="badge bg-danger">Cr√©dito</span></td>
                                <td class="text-end" style="color: #16a34a; font-weight: 600;">+$250,000</td>
                            </tr>
                            <tr>
                                <td>10:30</td>
                                <td><i class="fas fa-heartbeat text-success"></i> Control + Vacuna</td>
                                <td>Ana L√≥pez</td>
                                <td><span class="badge bg-success">Efectivo</span></td>
                                <td class="text-end" style="color: #16a34a; font-weight: 600;">+$28,000</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Secci√≥n principal: Inventario + Agenda + Hospitalizaci√≥n -->
<div class="row">
    <!-- Estado del Inventario -->
    <div class="col-md-4">
        <div class="card card-round agenda-hospitalization-card">
            <div class="card-body">
                <div class="card-title section-title">
                    <i class="fas fa-boxes"></i> Estado del Inventario
                </div>
                
                <!-- Mini Stats -->
                <div class="inventory-stats">
                    <div class="stat-mini-card stat-low">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h4>8</h4>
                        <p>Stock Bajo</p>
                    </div>
                    <div class="stat-mini-card stat-medium">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <h4>15</h4>
                        <p>Stock Medio</p>
                    </div>
                    <div class="stat-mini-card stat-ok">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h4>142</h4>
                        <p>Stock OK</p>
                    </div>
                </div>

                <!-- Product List -->
                <div class="product-list">
                    <div class="product-item">
                        <span class="product-name">Revolution Plus</span>
                        <div class="product-stock">
                            <span class="stock-badge low">4 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Bravecto 40-56Kg</span>
                        <div class="product-stock">
                            <span class="stock-badge low">7 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">NexGard Spectra</span>
                        <div class="product-stock">
                            <span class="stock-badge low">6 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Frontline Plus Perros</span>
                        <div class="product-stock">
                            <span class="stock-badge low">5 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Heartgard Plus</span>
                        <div class="product-stock">
                            <span class="stock-badge low">3 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Bravecto 10-20Kg</span>
                        <div class="product-stock">
                            <span class="stock-badge medium">12 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Advocate Gatos</span>
                        <div class="product-stock">
                            <span class="stock-badge medium">14 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Nexgard 25-50Kg</span>
                        <div class="product-stock">
                            <span class="stock-badge medium">11 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Simparica Trio</span>
                        <div class="product-stock">
                            <span class="stock-badge ok">28 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Bravecto Gatos</span>
                        <div class="product-stock">
                            <span class="stock-badge ok">22 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Advantix Perros Grandes</span>
                        <div class="product-stock">
                            <span class="stock-badge ok">31 unid.</span>
                        </div>
                    </div>
                    <div class="product-item">
                        <span class="product-name">Seresto Collar Perros</span>
                        <div class="product-stock">
                            <span class="stock-badge ok">18 unid.</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Agenda de hoy con Timeline -->
    <div class="col-md-4">
        <div class="card card-round agenda-hospitalization-card">
            <div class="card-body">
                <div class="card-title section-title">
                    <i class="fas fa-calendar-check"></i> Agenda de hoy
                </div>
                
                <div class="agenda-timeline">
                    <!-- 09:00 -->
                    <div class="timeline-hour">
                        <div class="timeline-hour-label">09:00</div>
                        <div class="timeline-appointments">
                            <div class="agenda-card type-control" onclick="showPetInfo('Max', 'Golden Retriever', '5 a√±os', 'Macho', '32 kg', 'Mar√≠a Gonz√°lez', '+56 9 8765 4321', 'Control post-operatorio')">
                                <h6><i class="fas fa-heartbeat"></i> Control</h6>
                                <p><strong>Max</strong> ¬∑ Golden Retriever</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Mar√≠a Gonz√°lez</p>
                                <p class="text-muted">Dra. Rodr√≠guez</p>
                            </div>
                        </div>
                    </div>

                    <!-- 10:00 - M√∫ltiples citas -->
                    <div class="timeline-hour">
                        <div class="timeline-hour-label">10:00</div>
                        <div class="timeline-appointments">
                            <div class="agenda-card type-consulta" onclick="showPetInfo('Firulais', 'Labrador', '3 a√±os', 'Macho', '28 kg', 'Carlos P√©rez', '+56 9 1234 5678', 'Consulta general')">
                                <h6><i class="fas fa-stethoscope"></i> Consulta</h6>
                                <p><strong>Firulais</strong> ¬∑ Labrador</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Carlos P√©rez</p>
                                <p class="text-muted">Dr. Torres</p>
                            </div>
                            <div class="agenda-card type-vacuna" onclick="showPetInfo('Michi', 'Gato Persa', '2 a√±os', 'Hembra', '4.5 kg', 'Ana L√≥pez', '+56 9 2345 6789', 'Vacuna antirr√°bica')">
                                <h6><i class="fas fa-syringe"></i> Vacuna</h6>
                                <p><strong>Michi</strong> ¬∑ Gato Persa</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Ana L√≥pez</p>
                                <p class="text-muted">Dra. Silva</p>
                            </div>
                        </div>
                    </div>

                    <!-- 11:00 -->
                    <div class="timeline-hour">
                        <div class="timeline-hour-label">11:00</div>
                        <div class="timeline-appointments">
                            <div class="agenda-card type-consulta" onclick="showPetInfo('Luna', 'Beagle', '4 a√±os', 'Hembra', '12 kg', 'Pedro S√°nchez', '+56 9 3456 7890', 'Revisi√≥n de rutina')">
                                <h6><i class="fas fa-stethoscope"></i> Consulta</h6>
                                <p><strong>Luna</strong> ¬∑ Beagle</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Pedro S√°nchez</p>
                                <p class="text-muted">Dr. Torres</p>
                            </div>
                        </div>
                    </div>

                    <!-- 12:00 - M√∫ltiples citas -->
                    <div class="timeline-hour">
                        <div class="timeline-hour-label">12:00</div>
                        <div class="timeline-appointments">
                            <div class="agenda-card type-vacuna" onclick="showPetInfo('Bobby', 'Bulldog', '6 a√±os', 'Macho', '25 kg', 'Laura Mart√≠nez', '+56 9 4567 8901', 'Vacuna m√∫ltiple')">
                                <h6><i class="fas fa-syringe"></i> Vacuna</h6>
                                <p><strong>Bobby</strong> ¬∑ Bulldog</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Laura Mart√≠nez</p>
                                <p class="text-muted">Dra. Silva</p>
                            </div>
                            <div class="agenda-card type-control" onclick="showPetInfo('Pelusa', 'Gato Persa', '7 a√±os', 'Hembra', '5 kg', 'Roberto D√≠az', '+56 9 5678 9012', 'Control de peso')">
                                <h6><i class="fas fa-heartbeat"></i> Control</h6>
                                <p><strong>Pelusa</strong> ¬∑ Persa</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Roberto D√≠az</p>
                                <p class="text-muted">Dra. Rodr√≠guez</p>
                            </div>
                        </div>
                    </div>

                    <!-- 15:00 - Cirug√≠a -->
                    <div class="timeline-hour">
                        <div class="timeline-hour-label">15:00</div>
                        <div class="timeline-appointments">
                            <div class="agenda-card type-cirugia" onclick="showPetInfo('Tommy', 'Schnauzer', '8 a√±os', 'Macho', '15 kg', 'Sof√≠a Ram√≠rez', '+56 9 6789 0123', 'Cirug√≠a de urgencia')">
                                <h6><i class="fas fa-scissors"></i> Cirug√≠a</h6>
                                <p><strong>Tommy</strong> ¬∑ Schnauzer</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Sof√≠a Ram√≠rez</p>
                                <p class="text-muted">Dr. P√©rez</p>
                                <span class="badge bg-danger">Urgente</span>
                            </div>
                        </div>
                    </div>

                    <!-- 16:00 - 3 citas simult√°neas -->
                    <div class="timeline-hour">
                        <div class="timeline-hour-label">16:00</div>
                        <div class="timeline-appointments">
                            <div class="agenda-card type-consulta" onclick="showPetInfo('Rex', 'Pastor Alem√°n', '5 a√±os', 'Macho', '35 kg', 'Miguel Torres', '+56 9 7890 1234', 'Consulta')">
                                <h6><i class="fas fa-stethoscope"></i> Consulta</h6>
                                <p><strong>Rex</strong> ¬∑ Pastor</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Miguel Torres</p>
                                <p class="text-muted">Dr. Torres</p>
                            </div>
                            <div class="agenda-card type-vacuna" onclick="showPetInfo('Coco', 'Poodle', '3 a√±os', 'Hembra', '8 kg', 'Claudia Vargas', '+56 9 8901 2345', 'Vacuna')">
                                <h6><i class="fas fa-syringe"></i> Vacuna</h6>
                                <p><strong>Coco</strong> ¬∑ Poodle</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Claudia Vargas</p>
                                <p class="text-muted">Dra. Silva</p>
                            </div>
                            <div class="agenda-card type-control" onclick="showPetInfo('Nina', 'Gato Siam√©s', '4 a√±os', 'Hembra', '4 kg', 'Jos√© Herrera', '+56 9 9012 3456', 'Control')">
                                <h6><i class="fas fa-heartbeat"></i> Control</h6>
                                <p><strong>Nina</strong> ¬∑ Siam√©s</p>
                                <p class="owner-name"><i class="fas fa-user"></i> Jos√© Herrera</p>
                                <p class="text-muted">Dra. Rodr√≠guez</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hospitalizaci√≥n -->
    <div class="col-md-4">
        <div class="card card-round agenda-hospitalization-card">
            <div class="card-body">
                <div class="card-title section-title">
                    <i class="fas fa-hospital"></i> En hospitalizaci√≥n
                </div>
                <div class="hospitalization-content">
                    <div class="hospitalization-card" onclick="showPetInfo('Max', 'Golden Retriever', '5 a√±os', 'Macho', '32 kg', 'Mar√≠a Gonz√°lez', '+56 9 8765 4321', 'Post-operatorio')">
                        <h6>Post-operatorio</h6>
                        <p>Mascota: <strong>Max</strong></p>
                        <p class="owner-name"><i class="fas fa-user"></i> Mar√≠a Gonz√°lez</p>
                        <p>Estado: <span class="badge bg-success">De alta</span></p>
                    </div>
                    <div class="hospitalization-card" onclick="showPetInfo('Kira', 'Pastor Belga', '6 a√±os', 'Hembra', '27 kg', 'Fernando Ruiz', '+56 9 7654 3210', 'Observaci√≥n post-cirug√≠a')">
                        <h6>Observaci√≥n</h6>
                        <p>Mascota: <strong>Kira</strong></p>
                        <p class="owner-name"><i class="fas fa-user"></i> Fernando Ruiz</p>
                        <p>Estado: <span class="badge bg-warning">En observaci√≥n</span></p>
                    </div>
                    <div class="hospitalization-card" onclick="showPetInfo('Rocky', 'Boxer', '4 a√±os', 'Macho', '30 kg', 'Patricia Vega', '+56 9 6543 2109', 'Recuperaci√≥n')">
                        <h6>Recuperaci√≥n</h6>
                        <p>Mascota: <strong>Rocky</strong></p>
                        <p class="owner-name"><i class="fas fa-user"></i> Patricia Vega</p>
                        <p>Estado: <span class="badge bg-info">Estable</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Segunda fila: estad√≠sticas -->
<div class="row mt-4">
    <!-- Consumo de Insumos con Tabs -->
    <div class="col-md-6">
        <div class="card card-round">
            <div class="card-body">
                <div class="card-title section-title">
                    <i class="fas fa-pills"></i> Consumo de Insumos Veterinarios
                </div>
                
                <!-- Tabs -->
                <div class="chart-tabs">
                    <button class="chart-tab active" onclick="switchTab('masUsados')">
                        <i class="fas fa-fire"></i> M√°s Usados
                    </button>
                    <button class="chart-tab" onclick="switchTab('rotacion')">
                        <i class="fas fa-sync"></i> Rotaci√≥n
                    </button>
                    <button class="chart-tab" onclick="switchTab('consumo')">
                        <i class="fas fa-chart-line"></i> Tendencia
                    </button>
                    <button class="chart-tab" onclick="switchTab('categoria')">
                        <i class="fas fa-tags"></i> Por Categor√≠a
                    </button>
                </div>

                <!-- Chart Content: M√°s Usados -->
                <div id="masUsados" class="chart-content active">
                    <canvas id="topProductsChart" height="200"></canvas>
                </div>

                <!-- Chart Content: Rotaci√≥n -->
                <div id="rotacion" class="chart-content">
                    <canvas id="rotacionChart" height="200"></canvas>
                </div>

                <!-- Chart Content: Tendencia de Consumo -->
                <div id="consumo" class="chart-content">
                    <canvas id="consumoChart" height="200"></canvas>
                </div>

                <!-- Chart Content: Por Categor√≠a -->
                <div id="categoria" class="chart-content">
                    <canvas id="categoriaChart" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Tipos de Atenci√≥n -->
    <div class="col-md-6">
        <div class="card card-round">
            <div class="card-body">
                <div class="card-title section-title">Tipos de atenci√≥n</div>
                <canvas id="serviceChart" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Pet Info Modal -->
<div class="pet-info-overlay" id="petInfoOverlay" onclick="closePetInfo()"></div>
<div class="pet-info-modal" id="petInfoModal">
    <button class="btn-close-modal" onclick="closePetInfo()">&times;</button>
    <div class="pet-info-header">
        <div class="pet-avatar">
            <i class="fas fa-paw"></i>
        </div>
        <div>
            <h5 id="modalPetName"></h5>
            <p id="modalPetBreed"></p>
        </div>
    </div>
    <div class="pet-info-body">
        <div class="pet-info-row">
            <span class="pet-info-label">Edad:</span>
            <span class="pet-info-value" id="modalPetAge"></span>
        </div>
        <div class="pet-info-row">
            <span class="pet-info-label">Sexo:</span>
            <span class="pet-info-value" id="modalPetGender"></span>
        </div>
        <div class="pet-info-row">
            <span class="pet-info-label">Peso:</span>
            <span class="pet-info-value" id="modalPetWeight"></span>
        </div>
        <div class="pet-info-row">
            <span class="pet-info-label">Propietario:</span>
            <span class="pet-info-value" id="modalPetOwner"></span>
        </div>
        <div class="pet-info-row">
            <span class="pet-info-label">Tel√©fono:</span>
            <span class="pet-info-value" id="modalPetPhone"></span>
        </div>
        <div class="pet-info-row">
            <span class="pet-info-label">Motivo:</span>
            <span class="pet-info-value" id="modalPetReason"></span>
        </div>
    </div>
    <div class="pet-info-actions">
        <button class="btn btn-sm btn-primary" onclick="openRecord()">
            <i class="fas fa-folder-open"></i> Abrir Ficha
        </button>
        <button class="btn btn-sm btn-success" onclick="callOwner()">
            <i class="fas fa-phone"></i> Llamar
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Pet Info Modal Scripts -->
<script>
    function showPetInfo(name, breed, age, gender, weight, owner, phone, reason) {
        document.getElementById('modalPetName').textContent = name;
        document.getElementById('modalPetBreed').textContent = breed;
        document.getElementById('modalPetAge').textContent = age;
        document.getElementById('modalPetGender').textContent = gender;
        document.getElementById('modalPetWeight').textContent = weight;
        document.getElementById('modalPetOwner').textContent = owner;
        document.getElementById('modalPetPhone').textContent = phone;
        document.getElementById('modalPetReason').textContent = reason;
        
        document.getElementById('petInfoOverlay').classList.add('show');
        document.getElementById('petInfoModal').classList.add('show');
    }

    function closePetInfo() {
        document.getElementById('petInfoOverlay').classList.remove('show');
        document.getElementById('petInfoModal').classList.remove('show');
    }

    function openRecord() {
        alert('Abriendo ficha cl√≠nica de ' + document.getElementById('modalPetName').textContent);
    }

    function callOwner() {
        const phone = document.getElementById('modalPetPhone').textContent;
        window.location.href = 'tel:' + phone;
    }

    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closePetInfo();
        }
    });

    function switchTab(tabName) {
        document.querySelectorAll('.chart-content').forEach(content => {
            content.classList.remove('active');
        });
        
        document.querySelectorAll('.chart-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        document.getElementById(tabName).classList.add('active');
        event.target.closest('.chart-tab').classList.add('active');
    }
</script>

<!-- Charts -->
<script>
    // Top 5 Productos M√°s Usados
    const ctx1 = document.getElementById('topProductsChart');
    const topProductsChart = new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: ['Revolution Plus', 'Bravecto 40-56Kg', 'NexGard Spectra', 'Simparica Trio', 'Advocate Gatos'],
            datasets: [{
                label: 'Unidades consumidas',
                data: [145, 128, 98, 87, 76],
                backgroundColor: ['#fa709a', '#fee140', '#4facfe', '#43e97b', '#f093fb']
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } }
        }
    });

    // Velocidad de Rotaci√≥n
    const ctx2 = document.getElementById('rotacionChart');
    const rotacionChart = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: ['Revolution Plus', 'Heartgard Plus', 'Frontline Plus', 'Bravecto Gatos', 'NexGard'],
            datasets: [{
                label: 'D√≠as hasta agotarse',
                data: [8, 12, 15, 22, 18],
                backgroundColor: ['#dc2626', '#f59e0b', '#fbbf24', '#43e97b', '#16a34a']
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { title: { display: true, text: 'D√≠as' } } }
        }
    });

    // Tendencia de Consumo
    const ctx3 = document.getElementById('consumoChart');
    const consumoChart = new Chart(ctx3, {
        type: 'line',
        data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
            datasets: [
                {
                    label: 'Antiparasitarios',
                    data: [145, 152, 168, 175, 189, 198],
                    borderColor: '#fa709a',
                    backgroundColor: 'rgba(250, 112, 154, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Antibi√≥ticos',
                    data: [89, 95, 88, 102, 98, 105],
                    borderColor: '#4facfe',
                    backgroundColor: 'rgba(79, 172, 254, 0.1)',
                    tension: 0.4
                },
                {
                    label: 'Vacunas',
                    data: [67, 72, 78, 81, 85, 92],
                    borderColor: '#43e97b',
                    backgroundColor: 'rgba(67, 233, 123, 0.1)',
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } }
        }
    });

    // Por Categor√≠a
    const ctx4 = document.getElementById('categoriaChart');
    const categoriaChart = new Chart(ctx4, {
        type: 'doughnut',
        data: {
            labels: ['Antiparasitarios', 'Antibi√≥ticos', 'Vacunas', 'Analg√©sicos', 'Suplementos'],
            datasets: [{
                data: [35, 25, 18, 12, 10],
                backgroundColor: ['#fa709a', '#4facfe', '#43e97b', '#fbbf24', '#f093fb']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } }
        }
    });

    // Tipos de Atenci√≥n
    const ctx5 = document.getElementById('serviceChart');
    new Chart(ctx5, {
        type: 'doughnut',
        data: {
            labels: ['Consultas', 'Vacunas', 'Cirug√≠as'],
            datasets: [{
                data: [55, 25, 20],
                backgroundColor: ['#AFE1AF', '#89C57C', '#6BAF6B']
            }]
        }
    });
</script>
{% endblock %}