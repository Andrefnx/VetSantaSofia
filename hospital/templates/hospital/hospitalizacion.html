{% extends "partials/base_table.html" %}
{% load static %}

{% block title %}Hospitalización{% endblock %}

{% block extra_css %}
<style>
    .estado-badge {
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 12px;
        font-weight: bold;
    }
    .estado-ingresado { background: #2196F3; color: white; }
    .estado-en_tratamiento { background: #FF9800; color: white; }
    .estado-recuperacion { background: #4CAF50; color: white; }
    .estado-alta { background: #9E9E9E; color: white; }
</style>
{% endblock %}

{% block table_title %}
<i class="fas fa-hospital"></i> Hospitalización
{% endblock %}

{% block table_buttons %}
<button type="button" onclick="abrirModalNuevaHospitalizacion()">
    <i class="fas fa-plus-circle"></i> Nueva Hospitalización
</button>
{% endblock %}

{% block table_columns %}
<th>Mascota</th>
<th>Propietario</th>
<th>Fecha Ingreso</th>
<th>Motivo</th>
<th>Estado</th>
<th>Gestión</th>
{% endblock %}

{% block table_rows %}
{% for hosp in hospitalizaciones %}
<tr>
    <td>{{ hosp.idMascota.nombre }}</td>
    <td>{{ hosp.idMascota.propietario.nombre }} {{ hosp.idMascota.propietario.apellido }}</td>
    <td>{{ hosp.fecha_ingreso|date:"d/m/Y H:i" }}</td>
    <td>{{ hosp.motivo|truncatewords:10 }}</td>
    <td>
        <span class="estado-badge estado-{{ hosp.estado_hosp }}">
            {{ hosp.get_estado_hosp_display }}
        </span>
    </td>
    <td>
        <div class="manage-wheel">
            <button type="button" onclick="toggleWheel(this)">
                <i class="fas fa-cog"></i>
            </button>
            <div class="manage-options" style="display: none;">
                <button type="button" onclick="verDetalles({{ hosp.id }})">
                    <i class="fas fa-eye"></i> Ver detalles
                </button>
                <button type="button" onclick="editarHospitalizacion({{ hosp.id }})">
                    <i class="fas fa-edit"></i> Editar
                </button>
                <button type="button" onclick="darAlta({{ hosp.id }})">
                    <i class="fas fa-sign-out-alt"></i> Dar Alta
                </button>
            </div>
        </div>
    </td>
</tr>
{% empty %}
<tr>
    <td colspan="6">No hay hospitalizaciones registradas.</td>
</tr>
{% endfor %}
{% endblock %}

{% block extra_js %}
<script>
function toggleWheel(btn) {
    const options = btn.nextElementSibling;
    options.style.display = options.style.display === 'none' ? 'block' : 'none';
}

function abrirModalNuevaHospitalizacion() {
    alert('Funcionalidad en desarrollo');
}

function verDetalles(id) {
    window.location.href = `/hospital/hospitalizacion/${id}/`;
}

function editarHospitalizacion(id) {
    alert('Funcionalidad en desarrollo');
}

function darAlta(id) {
    if(confirm('¿Está seguro de dar de alta a este paciente?')) {
        alert('Funcionalidad en desarrollo');
    }
}
</script>
{% endblock %}