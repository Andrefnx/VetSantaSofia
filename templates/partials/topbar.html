{% load static %}
{% load static %}

<style>
    /* Cash Status Button en Navbar */
    .navbar-header-left .cash-status-btn {
        margin: 0;
    }

    .cash-status-btn {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 16px;
        border-radius: 10px;
        border: 2px solid;
        font-weight: 600;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .cash-status-btn.open {
        background: linear-gradient(135deg, rgba(67, 233, 123, 0.1) 0%, rgba(56, 249, 215, 0.1) 100%);
        border-color: #43e97b;
        color: #16a34a;
    }

    .cash-status-btn.open:hover {
        background: linear-gradient(135deg, rgba(67, 233, 123, 0.2) 0%, rgba(56, 249, 215, 0.2) 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(67, 233, 123, 0.2);
    }

    .cash-status-btn.closed {
        background: linear-gradient(135deg, rgba(250, 112, 154, 0.1) 0%, rgba(254, 225, 64, 0.1) 100%);
        border-color: #fa709a;
        color: #dc2626;
    }

    .cash-status-btn.closed:hover {
        background: linear-gradient(135deg, rgba(250, 112, 154, 0.2) 0%, rgba(254, 225, 64, 0.2) 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(250, 112, 154, 0.2);
    }

    .cash-status-btn .status-icon {
        font-size: 1.3rem;
    }

    .cash-status-btn .status-info h6 {
        margin: 0;
        font-size: 0.75rem;
        opacity: 0.8;
    }

    .cash-status-btn .status-info .amount {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 700;
    }

    /* Versión móvil más compacta */
    .cash-status-mobile {
        padding: 6px 12px;
        gap: 8px;
    }

    .cash-status-mobile .status-info h6 {
        font-size: 0.65rem;
    }

    .cash-status-mobile .status-info .amount {
        font-size: 0.9rem;
    }

    .cash-status-mobile .status-icon {
        font-size: 1.1rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .navbar-header-left {
            display: none !important;
        }
    }
</style>
<div class="main-header">
    <div class="main-header-logo">
        <!-- Logo Header -->
        <div class="logo-header" data-background-color="dark">
            <a href="{% url 'dashboard' %}" class="logo">
                <img src="{% static 'img/logo.png' %}" alt="navbar brand" class="navbar-brand" height="40" />
            </a>
            <div class="nav-toggle">
                <button class="btn btn-toggle toggle-sidebar">
                    <i class="gg-menu-right"></i>
                </button>
                <button class="btn btn-toggle sidenav-toggler">
                    <i class="gg-menu-left"></i>
                </button>
            </div>
            <button class="topbar-toggler more">
                <i class="gg-more-vertical-alt"></i>
            </button>
        </div>
        <!-- End Logo Header -->
    </div>
    <!-- Navbar Header -->
    <nav class="navbar navbar-header navbar-header-transparent navbar-expand-lg border-bottom">
        <div class="container-fluid">
            <!-- Cash Status Button (reemplaza el search) -->
            <nav class="navbar navbar-header-left navbar-expand-lg p-0 d-none d-lg-flex">
                <div class="cash-status-btn open" id="cashStatusBtn" onclick="toggleCashRegister()">
                    <div class="status-icon">
                        <i class="fas fa-cash-register"></i>
                    </div>
                    <div class="status-info">
                        <h6 id="cashStatusLabel">Caja Abierta</h6>
                        <div class="amount" id="cashAmount">$1,245,500</div>
                    </div>
                </div>
            </nav>

            <ul class="navbar-nav topbar-nav ms-md-auto align-items-center">
                <!-- Cash Status Mobile (reemplaza search mobile) -->
                <li class="nav-item topbar-icon d-flex d-lg-none">
                    <div class="cash-status-btn open cash-status-mobile" id="cashStatusBtnMobile" onclick="toggleCashRegister()">
                        <div class="status-icon">
                            <i class="fas fa-cash-register"></i>
                        </div>
                        <div class="status-info">
                            <h6 id="cashStatusLabelMobile">Caja</h6>
                            <div class="amount" id="cashAmountMobile">$1.2M</div>
                        </div>
                    </div>
                </li>

                <li class="nav-item topbar-icon dropdown hidden-caret">
                    <a class="nav-link dropdown-toggle" href="#" id="messageDropdown" role="button"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-envelope"></i>
                    </a>
                    <ul class="dropdown-menu messages-notif-box animated fadeIn" aria-labelledby="messageDropdown">
                        <li>
                            <div class="dropdown-title d-flex justify-content-between align-items-center">
                                Mensajes
                                <a href="#" class="small">Marcar todo como leído</a>
                            </div>
                        </li>
                        <li>
                            <div class="message-notif-scroll scrollbar-outer">
                                <div class="notif-center">
                                    <a href="#">
                                        <div class="notif-content">
                                            <span class="subject">Sistema</span>
                                            <span class="block">No hay mensajes nuevos</span>
                                            <span class="time">Ahora</span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a class="see-all" href="javascript:void(0);">Ver todos los mensajes<i
                                    class="fa fa-angle-right"></i></a>
                        </li>
                    </ul>
                </li>

                <li class="nav-item topbar-icon dropdown hidden-caret">
                    <a class="nav-link dropdown-toggle" href="#" id="notifDropdown" role="button"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-bell"></i>
                        <span class="notification">0</span>
                    </a>
                    <ul class="dropdown-menu notif-box animated fadeIn" aria-labelledby="notifDropdown">
                        <li>
                            <div class="dropdown-title">No tienes notificaciones nuevas</div>
                        </li>
                        <li>
                            <div class="notif-scroll scrollbar-outer">
                                <div class="notif-center">
                                    <a href="#">
                                        <div class="notif-icon notif-primary">
                                            <i class="fa fa-info"></i>
                                        </div>
                                        <div class="notif-content">
                                            <span class="block">Sin notificaciones</span>
                                            <span class="time">Ahora</span>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a class="see-all" href="javascript:void(0);">Ver todas las notificaciones<i
                                    class="fa fa-angle-right"></i></a>
                        </li>
                    </ul>
                </li>

                <li class="nav-item topbar-user dropdown hidden-caret">
                    <a class="dropdown-toggle profile-pic" data-bs-toggle="dropdown" href="#" aria-expanded="false">
                        <span class="profile-username">
                            <span class="fw-bold">{{ user.nombre }} {{ user.apellido }}</span>
                        </span>
                    </a>
                    <ul class="dropdown-menu dropdown-user animated fadeIn">
                        <div class="dropdown-user-scroll scrollbar-outer">
                            <li>
                                <div class="user-box">
                                    <div class="u-text">
                                        <h4>{{ user.nombre }} {{ user.apellido }}</h4>
                                        <p class="text-muted">{{ user.correo }}</p>
                                        <span class="badge badge-info">{{ user.get_rol_display_custom }}</span>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">Mi Perfil</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#" onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
                                    Cerrar Sesión
                                </a>
                                <form id="logout-form" method="POST" action="{% url 'logout' %}" style="display: none;">
                                    {% csrf_token %}
                                </form>
                            </li>
                        </div>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>
    <!-- End Navbar -->
</div>

<!-- Modal: Abrir Caja -->
<div class="modal fade" id="abrirCajaModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-cash-register"></i> Abrir Caja</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Monto Inicial</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="number" class="form-control" id="montoInicial" placeholder="0">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Observaciones (opcional)</label>
                    <textarea class="form-control" rows="2" placeholder="Notas sobre la apertura..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="openCashRegister()">
                    <i class="fas fa-unlock"></i> Abrir Caja
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Cerrar Caja -->
<div class="modal fade" id="cerrarCajaModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-lock"></i> Cerrar Caja</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h6>Monto Inicial</h6>
                                <h3 class="text-success">$500,000</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h6>Total en Caja</h6>
                                <h3 class="text-primary">$1,245,500</h3>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Monto Real Contado</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="number" class="form-control" id="montoReal" placeholder="0">
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Observaciones (opcional)</label>
                    <textarea class="form-control" rows="2" placeholder="Notas sobre el cierre..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" onclick="closeCashRegister()">
                    <i class="fas fa-lock"></i> Cerrar Caja
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function toggleCashRegister() {
    const cashOpen = document.getElementById('cashStatusBtn').classList.contains('open');
    
    if (cashOpen) {
        // Mostrar modal de cerrar caja
        const modal = new bootstrap.Modal(document.getElementById('cerrarCajaModal'));
        modal.show();
    } else {
        // Mostrar modal de abrir caja
        const modal = new bootstrap.Modal(document.getElementById('abrirCajaModal'));
        modal.show();
    }
}

function openCashRegister() {
    const montoInicial = document.getElementById('montoInicial').value;
    
    if (!montoInicial || montoInicial <= 0) {
        alert('Por favor ingresa un monto inicial válido');
        return;
    }
    
    // Actualizar estado de la caja
    document.getElementById('cashStatusBtn').classList.remove('closed');
    document.getElementById('cashStatusBtn').classList.add('open');
    document.getElementById('cashStatusLabel').textContent = 'Caja Abierta';
    document.getElementById('cashAmount').textContent = '$' + parseInt(montoInicial).toLocaleString();
    
    // Versión móvil
    document.getElementById('cashStatusBtnMobile').classList.remove('closed');
    document.getElementById('cashStatusBtnMobile').classList.add('open');
    document.getElementById('cashStatusLabelMobile').textContent = 'Caja';
    
    // Cerrar modal
    bootstrap.Modal.getInstance(document.getElementById('abrirCajaModal')).hide();
    
    // Aquí puedes hacer una llamada AJAX para guardar en el backend
    console.log('Caja abierta con monto:', montoInicial);
}

function closeCashRegister() {
    const montoReal = document.getElementById('montoReal').value;
    
    if (!montoReal || montoReal <= 0) {
        alert('Por favor ingresa el monto real contado');
        return;
    }
    
    // Actualizar estado de la caja
    document.getElementById('cashStatusBtn').classList.remove('open');
    document.getElementById('cashStatusBtn').classList.add('closed');
    document.getElementById('cashStatusLabel').textContent = 'Caja Cerrada';
    document.getElementById('cashAmount').textContent = '$0';
    
    // Versión móvil
    document.getElementById('cashStatusBtnMobile').classList.remove('open');
    document.getElementById('cashStatusBtnMobile').classList.add('closed');
    document.getElementById('cashStatusLabelMobile').textContent = 'Cerrada';
    
    // Cerrar modal
    bootstrap.Modal.getInstance(document.getElementById('cerrarCajaModal')).hide();
    
    // Aquí puedes hacer una llamada AJAX para guardar en el backend
    console.log('Caja cerrada con monto real:', montoReal);
}
</script>