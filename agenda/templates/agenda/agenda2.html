{% extends 'partials/base.html' %}
{% load static %}

{% block title %}Agenda{% endblock %}

{% block content %}
<div class="header">
    <h1>
        <i class="bi bi-calendar3"></i> Agenda
    </h1>
    <div class="edit-mode">
        <button class="vet-btn vet-btn-primary">
            <i class="bi bi-pencil-square"></i> Editar Ficha
        </button>
    </div>
</div>

<div class="general-container">

    <div class="general-information">
        <!-- ...existing info blocks... -->
        <div class="section calendar-section">
            <div class="calendar-display">
                <div class="calendar-widget">
                    <div class="calendar-header">
                        <button id="prevMonthBtn" class="calendar-nav-btn">&lt;</button>
                        <span id="calendarMonthYear" class="calendar-month-label"></span>
                        <button id="nextMonthBtn" class="calendar-nav-btn">&gt;</button>
                    </div>
                    <div class="calendar-body">
                        <div class="calendar-days-row">
                            <span>Lu</span><span>Ma</span><span>Mi</span><span>Ju</span><span>Vi</span><span>Sa</span><span>Do</span>
                        </div>
                        <div id="calendarDaysGrid" class="calendar-days-grid"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div class="section tabs-section">
        <div class="tabs-nav">

            <button class="tab-btn active" data-tab="diario">Diario</button>
            <button class="tab-btn" data-tab="mensual">Mensual</button>
            <button class="tab-btn" data-tab="semanal">Semanal</button>
            <button class="tab-btn" data-tab="disponibilidad">Disponibilidad</button>

        </div>
        <div class="tabs-content">

            <div class="tab-content" id="diario">
                <div class="agenda-daily active">

                    <!-- PANEL LATERAL -->
                    <aside class="agenda-sidebar">
              
                        <!-- Calendario pequeño -->
                        
                        <!-- Categorías -->
                        <div class="agenda-categories">
                            <h4>Categorías</h4>
                            <label><input type="checkbox" checked> Consultas</label>
                            <label><input type="checkbox" checked> Vacunas</label>
                            <label><input type="checkbox" checked> Controles</label>
                            <label><input type="checkbox" checked> Procedimientos</label>
                        </div>
                    </aside>

                    <!-- PANEL PRINCIPAL -->
                    <main class="agenda-main">

                        <!-- Encabezado del día -->
                        <div class="agenda-main-header">
                            <button class="day-nav" id="dayPrev"><i class="bi bi-chevron-left"></i></button>
                            <h2 id="currentDay">15 de Marzo 2025</h2>
                            <button class="day-nav" id="dayNext"><i class="bi bi-chevron-right"></i></button>
                        </div>

                        <!-- GRID DE HORAS DEL DÍA -->
                        <div class="daily-grid scrollable-daily-grid">
                            {% for hour in horas %}
                            <div class="hour-block">
                                <div class="hour-label">{{ hour }}:00</div>
                                <div class="hour-slot">
                                    {% for q in minutos %}
                                        {% if hour == "09" and q == "00" %}
                                            <div class="quarter-block has-appointment cita-consulta" title="Consulta general">
                                                <div class="cita-info">
                                                    <span class="cita-tipo">Consulta</span>
                                                    <span class="cita-mascota">Rocky</span>
                                                    <span class="cita-especie">Canino</span>
                                                    <span class="cita-vet">Dra. Andrea</span>
                                                </div>
                                            </div>
                                        {% elif hour == "09" and q == "15" %}
                                            {# Bloque ocupado por la cita anterior (Consulta 30min) #}
                                        {% elif hour == "10" and q == "00" %}
                                            <div class="quarter-block has-appointment cita-vacunacion" title="Vacunación">
                                                <div class="cita-info">
                                                    <span class="cita-tipo">Vacunación</span>
                                                    <span class="cita-mascota">Luna</span>
                                                    <span class="cita-especie">Felino</span>
                                                    <span class="cita-vet">Dr. Carlos</span>
                                                </div>
                                            </div>
                                            
                                        {% elif hour == "10" and q == "15" %}
                                            <div class="quarter-block-group">
                                                <div class="quarter-block has-appointment cita-vacunacion" title="Vacunación">
                                                    <div class="cita-info">
                                                        <span class="cita-tipo">Vacunación</span>
                                                        <span class="cita-mascota">Luna</span>
                                                        <span class="cita-especie">Felino</span>
                                                        <span class="cita-vet">Dr. Carlos</span>
                                                    </div>
                                                </div>
                                                <div class="quarter-block has-appointment cita-control" title="Control">
                                                    <div class="cita-info">
                                                        <span class="cita-tipo">Control</span>
                                                        <span class="cita-mascota">Toby</span>
                                                        <span class="cita-especie">Canino</span>
                                                        <span class="cita-vet">Dra. Andrea</span>
                                                    </div>
                                                </div>
                                            </div>
                                        {% elif hour == "10" and q == "30" %}
                                            {# Bloque ocupado por la cita anterior (Control 30min) #}
                                        {% elif hour == "10" and q == "45" %}
                                            {# Vacío #}
                                            <div class="quarter-block" data-hour="{{ hour }}" data-minute="{{ q }}">
                                                <span class="quarter-label">{{ hour }}:{{ q }}</span>
                                                <span class="add-icon"><i class="bi bi-plus-circle"></i></span>
                                            </div>
                                        {% else %}
                                            <div class="quarter-block" data-hour="{{ hour }}" data-minute="{{ q }}">
                                                <span class="quarter-label">{{ hour }}:{{ q }}</span>
                                                <span class="add-icon"><i class="bi bi-plus-circle"></i></span>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </main>

                    <!-- PANEL DE INFORMACIÓN (DETALLE DE CITA) -->
                    <aside class="agenda-sidebar-right">
                        <h3>Detalle de Cita</h3>

                        <div id="appointmentDetail" class="appt-detail-empty">
                            Seleccione una cita para ver detalle
                        </div>     
                        <div id="appointmentDetail" class="appt-detail">
                        
                            <div class="appt-section appt-pet-info">
                                <strong>Mascota:</strong> Rocky<br>
                                <strong>Especie:</strong> Canino<br>
                                <strong>Raza:</strong> Labrador Retriever<br>
                                <strong>Edad:</strong> 3 años<br>
                                <strong>Sexo:</strong> Macho<br>
                                <a href="/ficha/mascota/123" class="vet-link" target="_blank">
                                    <i class="bi bi-card-list"></i> Ver ficha de mascota
                                </a>
                            </div>
                             <div class="appt-section appt-owner-info">
                                <strong>Dueño:</strong> Juan Pérez<br>
                                <strong>Teléfono:</strong> <a href="tel:+56912345678">+56 9 1234 5678</a><br>
                                <strong>Correo:</strong> <a href="mailto:juan.perez@email.com">juan.perez@email.com</a>
                            </div>
                            <div class="appt-section appt-vet-info">
                                <strong>Veterinario:</strong> Dra. Andrea Soto<br>
                                <a href="/veterinarios/45" class="vet-link" target="_blank">
                                    <i class="bi bi-person-badge"></i> Ver perfil veterinario
                                </a>
                            </div>
                        </div>
                        
                    </aside>

                </div>

            </div>
            <div class="tab-content " id="mensual">
                <div class="monthly-calendar-view">
                    <div class="monthly-calendar-table">
                        <div class="monthly-calendar-days-row">
                            <span>Lunes</span><span>Martes</span><span>Miércoles</span><span>Jueves</span><span>Viernes</span><span>Sábado</span><span>Domingo</span>
                        </div>
                        <div id="monthlyCalendarGrid" class="monthly-calendar-grid"></div>
                    </div>
                    <div class="monthly-calendar-legend">
                        <span class="legend-item legend-workorder">Consulta</span>
                        <span class="legend-item legend-movein">Vacunación</span>
                        <span class="legend-item legend-moveout">Control</span>
                        <span class="legend-item legend-note">Nota</span>
                    </div>
                </div>
            </div>



            <div class="tab-content" id="semanal"></div>

            <div class="tab-content" id="disponibilidad"></div>
        </div>
    </div>
</div>
{% endblock %}

{% block modals %}
<!-- Modal Detalle Consulta -->
<div id="detalleConsultaModal" class="vet-modal-overlay hide">
    <div class="vet-custom-modal">
        <div class="vet-custom-modal-title">
            <h3 id="detalleTitulo"><i class="bi bi-clipboard2-pulse"></i> Detalle de Consulta</h3>
            <i class="bi bi-x" id="closeDetalleModal" tabindex="0" role="button" aria-label="Cerrar"></i>
        </div>
        <div class="vet-modal-body">
            <div class="row g-3">
                <!-- Columna izquierda: Datos fisiológicos -->
                <div class="col-md-4" id="detalleDatosMascota">
                    <div class="detail-section">
                        <div class="detail-section-title"><i class="bi bi-thermometer-half"></i> Temperatura</div>
                        <p id="detalleTemp">-</p>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title"><i class="bi bi-speedometer2"></i> Peso</div>
                        <p id="detallePeso">-</p>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title"><i class="bi bi-heart-pulse"></i> Frec. Cardíaca</div>
                        <p id="detalleFC">-</p>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title"><i class="bi bi-wind"></i> Frec. Respiratoria</div>
                        <p id="detalleFR">-</p>
                    </div>
                    <div class="detail-section">
                        <div class="detail-section-title"><i class="bi bi-droplet-half"></i> Otros</div>
                        <p id="detalleOtros">-</p>
                    </div>
                </div>
                <!-- Columna derecha: Detalles de consulta -->
                <div class="col-md-8" id="detalleContenido">
                    <!-- Aquí se llenarán los detalles dinámicamente -->
                </div>
            </div>
        </div>
        <div class="vet-modal-footer d-flex justify-content-between align-items-center">
            <button id="editarConsultaBtn" class="vet-btn vet-btn-grey" title="Editar consulta">
                <i class="bi bi-pencil-square"></i> Editar consulta
            </button>
            <button class="vet-btn vet-btn-primary" id="btnAgendarCita">
                <i class="bi bi-calendar-plus"></i> Agendar próxima cita
            </button>
        </div>
    </div>
</div>

<!-- Modal Nueva Consulta -->
<div id="nuevaConsultaModal" class="vet-modal-overlay hide">
    <div class="vet-custom-modal">
        <div class="vet-custom-modal-title">
            <h3><i class="bi bi-clipboard2-plus"></i> Nueva Consulta</h3>
            <i class="bi bi-x" id="closeNuevaConsultaModal" tabindex="0" role="button" aria-label="Cerrar"></i>
        </div>
        <form id="formNuevaConsulta">
            <div class="vet-modal-body">
                <div class="row g-3">
                    <!-- Columna izquierda: Datos fisiológicos -->
                    <div class="col-md-4">
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-thermometer-half"></i> Temperatura</div>
                            <input type="text" class="form-control" name="temp" required>
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-speedometer2"></i> Peso</div>
                            <input type="text" class="form-control" name="peso" required>
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-heart-pulse"></i> Frec. Cardíaca</div>
                            <input type="text" class="form-control" name="fc">
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-wind"></i> Frec. Respiratoria</div>
                            <input type="text" class="form-control" name="fr">
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-droplet-half"></i> Otros</div>
                            <input type="text" class="form-control" name="otros">
                        </div>
                    </div>
                    <!-- Columna derecha: Detalles de consulta -->
                    <div class="col-md-8">
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-person-badge"></i> Médico Tratante</div>
                            <input type="text" class="form-control" name="medico"
                                value="{{ user.nombre }} {{ user.apellido }}" readonly>
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-calendar-event"></i> Fecha</div>
                            <input type="text" class="form-control" name="fecha" value="{% now 'd/m/Y' %}" readonly>
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-clipboard2-check"></i> Diagnóstico</div>
                            <input type="text" class="form-control" name="diagnostico">
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-capsule"></i> Tratamiento</div>
                            <input type="text" class="form-control" name="tratamiento">
                        </div>
                        <!-- Exámenes oculto -->
                        <div class="detail-section d-none">
                            <div class="detail-section-title"><i class="bi bi-file-earmark-medical"></i> Exámenes</div>
                            <input type="text" class="form-control" name="examenes" placeholder="Separar por coma">
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-journal-text"></i> Notas</div>
                            <textarea class="form-control" name="notas"></textarea>
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-lightbulb"></i> Recomendaciones</div>
                            <input type="text" class="form-control" name="recomendaciones">
                        </div>
                    </div>
                </div>
            </div>
            <div class="vet-modal-footer d-flex justify-content-between align-items-center">
                <span></span>
                <button type="submit" class="vet-btn vet-btn-primary" id="btnAgendarNuevaCita">
                    <i class="bi bi-calendar-plus"></i> Agendar y guardar en historial
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Agendar Cita -->
<div id="agendarCitaModal" class="vet-modal-overlay hide">
    <div class="vet-custom-modal">
        <div class="vet-custom-modal-title">
            <h3><i class="bi bi-calendar-plus"></i> Agendar Cita</h3>
            <i class="bi bi-x" id="closeAgendarCitaModal" tabindex="0" role="button" aria-label="Cerrar"></i>
        </div>
        <form id="formAgendarCita">
            <div class="vet-modal-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-calendar-event"></i> Fecha</div>
                            <input type="date" class="form-control" name="fecha" required>
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-clock"></i> Hora</div>
                            <input type="time" class="form-control" name="hora" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-list-task"></i> Tipo de Cita</div>
                            <select class="form-control" name="tipo" required>
                                <option value="">Seleccione tipo</option>
                                <option value="hospitalizacion">Hospitalización</option>
                                <option value="consulta">Consulta general</option>
                                <option value="control">Control</option>
                                <option value="vacunacion">Vacunación</option>
                            </select>
                        </div>
                        <div class="detail-section">
                            <div class="detail-section-title"><i class="bi bi-journal-text"></i> Notas</div>
                            <textarea class="form-control" name="notas"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="vet-modal-footer d-flex justify-content-between align-items-center">
                <span></span>
                <button type="submit" class="vet-btn vet-btn-primary">
                    <i class="bi bi-calendar-plus"></i> Agendar
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/base/tabs.js' %}"></script>
<script src="{% static 'js/base/calendar.js' %}"></script>
<script src="{% static 'agenda/js/agenda.js' %}"></script>
{% endblock %}
